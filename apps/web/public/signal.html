<!DOCTYPE html>
<html lang="bg">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ –Ω–æ–≤ —Å–∏–≥–Ω–∞–ª - –ú–æ—è—Ç –ë–æ—Ç–µ–≤–≥—Ä–∞–¥</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet.js CSS (–∑–∞ –∫–∞—Ä—Ç–∞—Ç–∞) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- –®—Ä–∏—Ñ—Ç Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* –°—Ç–∏–ª –∑–∞ –∫–∞—Ä—Ç–∞—Ç–∞ –≤ —Ç–∞–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
        #map-submit {
            height: 400px;
            /* 400px –≤–∏—Å–æ—á–∏–Ω–∞ */
            border-radius: 0.75rem;
            /* rounded-xl */
            z-index: 10;
        }

        /* –°—Ç–∏–ª–∏–∑–∏—Ä–∞–Ω –ø—Ä–µ–≤–∫–ª—é—á–≤–∞—Ç–µ–ª (toggle switch) */
        .toggle-bg:after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            background-color: white;
            width: 1.25rem;
            /* w-5 */
            height: 1.25rem;
            /* h-5 */
            border-radius: 9999px;
            /* rounded-full */
            transition: transform 0.2s ease-in-out;
        }

        input:checked+.toggle-bg:after {
            transform: translateX(100%);
        }

        input:checked+.toggle-bg {
            background-color: #16a34a;
            /* green-600 */
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col min-h-screen">

    <!-- Header - 1:1 with Next.js Header -->
    <header
        class="flex justify-between items-center px-4 py-2.5 border-b border-gray-200 z-50 bg-white shadow-sm sticky top-0">
        <!-- Left: Logo + Nav -->
        <div class="flex items-center gap-6">
            <a href="/" class="flex items-center">
                <div class="relative h-9 w-[180px] overflow-hidden">
                    <img src="/logo-selnet-full.png" alt="–°–µ–ª–ù–µ—Ç"
                        class="h-9 w-auto object-contain object-left transition-all duration-700" id="logo-selnet"
                        style="opacity: 1;">
                    <img src="/logo-botevgrad.png" alt="–ú–æ—è—Ç –ë–æ—Ç–µ–≤–≥—Ä–∞–¥"
                        class="absolute inset-0 h-9 w-auto object-contain object-left transition-all duration-700"
                        id="logo-botevgrad" style="opacity: 0;">
                </div>
            </a>
            <nav class="hidden md:flex items-center">
                <a href="/signals"
                    class="px-3 py-1.5 font-semibold text-sm text-gray-600 hover:text-green-600 transition-colors flex items-center gap-1.5 border border-gray-200 rounded-lg hover:border-green-400 hover:bg-green-50">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    –í—Å–∏—á–∫–∏ —Å–∏–≥–Ω–∞–ª–∏
                </a>
            </nav>
        </div>

        <!-- Right: Dynamic user section -->
        <div class="flex items-center gap-3" id="header-right">
            <!-- Will be populated by JavaScript based on login state -->
        </div>
    </header>

    <script>
        // Animated logo - switch every 5 seconds
        (function () {
            let showBotevgrad = false;
            setInterval(() => {
                showBotevgrad = !showBotevgrad;
                document.getElementById('logo-selnet').style.opacity = showBotevgrad ? '0' : '1';
                document.getElementById('logo-botevgrad').style.opacity = showBotevgrad ? '1' : '0';
            }, 5000);
        })();

        // Role labels
        const ROLE_LABELS = {
            'ADMIN': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
            'ADMINISTRATOR': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
            'MODERATOR': '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',
            'OPERATOR': '–û–ø–µ—Ä–∞—Ç–æ—Ä',
            'USER': '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª'
        };

        // Dynamic header based on user login state
        (function () {
            const headerRight = document.getElementById('header-right');

            // Try to get user from localStorage
            const userStr = localStorage.getItem('user');
            const token = localStorage.getItem('token') || localStorage.getItem('idToken') || localStorage.getItem('firebaseToken');

            if (userStr && token) {
                try {
                    const user = JSON.parse(userStr);
                    const displayName = user.displayName || user.email?.split('@')[0] || '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª';
                    const photoURL = user.photoURL;
                    const role = user.role || 'USER';
                    const roleLabel = ROLE_LABELS[role] || '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª';

                    // Get role-based link text and URL
                    let adminLinkText = '–ú–æ–∏—Ç–µ —Å–∏–≥–Ω–∞–ª–∏';
                    let adminLinkUrl = '/me';
                    if (role === 'ADMIN') {
                        adminLinkText = 'Admin Panel';
                        adminLinkUrl = '/admin';
                    } else if (role === 'ADMINISTRATOR') {
                        adminLinkText = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–∞–Ω–µ';
                        adminLinkUrl = '/administrator/signals';
                    } else if (role === 'MODERATOR') {
                        adminLinkText = '–ú–æ–¥–µ—Ä–∏—Ä–∞–Ω–µ';
                        adminLinkUrl = '/moderator';
                    } else if (role === 'OPERATOR') {
                        adminLinkText = '–û–ø–µ—Ä–∞—Ç–æ—Ä';
                        adminLinkUrl = '/operator';
                    }

                    // Build avatar HTML
                    let avatarHTML = '';
                    if (photoURL && (photoURL.startsWith('http') || photoURL.startsWith('data:'))) {
                        avatarHTML = `<img src="${photoURL}" alt="" class="h-full w-full object-cover">`;
                    } else {
                        avatarHTML = `
                        <svg class="h-full w-full text-gray-300 p-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg>
                    `;
                    }

                    // Build dropdown menu based on role
                    let dropdownItems = '';

                    if (role === 'USER' || !role) {
                        dropdownItems = `
                        <a href="/me" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                            –ú–æ–∏—Ç–µ —Å–∏–≥–Ω–∞–ª–∏
                        </a>
                        <a href="/profile" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                            –ü—Ä–æ—Ñ–∏–ª
                        </a>
                        <a href="/settings" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        </a>
                    `;
                    } else if (role === 'ADMINISTRATOR') {
                        dropdownItems = `
                        <a href="/administrator/signals" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" /></svg>
                            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª–∏
                        </a>
                        <a href="/administrator/users" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" /></svg>
                            –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ (read-only)
                        </a>
                        <a href="/profile" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                            –ü—Ä–æ—Ñ–∏–ª
                        </a>
                        <a href="/settings" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        </a>
                    `;
                    } else if (role === 'ADMIN') {
                        dropdownItems = `
                        <a href="/admin" class="flex items-center gap-2 px-4 py-2 text-sm text-purple-600 font-semibold hover:bg-purple-50">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" /></svg>
                            Admin Panel
                        </a>
                        <a href="/admin/users" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" /></svg>
                            –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
                        </a>
                        <a href="/admin/roles" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" /></svg>
                            –†–æ–ª–∏
                        </a>
                        <div class="border-t border-gray-100 my-1"></div>
                        <a href="/profile" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                            –ú–æ—è—Ç –ø—Ä–æ—Ñ–∏–ª
                        </a>
                        <a href="/settings" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        </a>
                    `;
                    }

                    headerRight.innerHTML = `
                    <!-- Notification Bell -->
                    <button class="relative p-1.5 rounded-full text-gray-500 hover:text-gray-800 hover:bg-gray-100 focus:outline-none transition-colors" onclick="window.location.href='${adminLinkUrl}'" title="–ò–∑–≤–µ—Å—Ç–∏—è">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                        </svg>
                    </button>
                    
                    <!-- Role-based link -->
                    <a href="${adminLinkUrl}" class="font-semibold text-sm text-gray-700 hover:text-green-600 transition-colors hidden sm:inline">
                        ${adminLinkText}
                    </a>
                    
                    <!-- User Profile Dropdown -->
                    <div class="relative" id="profile-dropdown">
                        <button class="flex items-center space-x-2 hover:opacity-80 transition-opacity focus:outline-none" onclick="toggleDropdown(event)">
                            <span class="inline-block h-8 w-8 overflow-hidden rounded-full bg-gray-100 ring-2 ring-gray-200 hover:ring-green-500 transition-all">
                                ${avatarHTML}
                            </span>
                            <div class="hidden sm:flex flex-col items-start">
                                <span class="font-semibold text-gray-900 text-sm">${displayName}</span>
                                <span class="text-xs text-gray-500">${roleLabel}</span>
                            </div>
                            <svg class="w-4 h-4 text-gray-500 hidden sm:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="dropdown-menu" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50">
                            ${dropdownItems}
                            <hr class="my-1 border-gray-200">
                            <button onclick="logout()" class="flex items-center gap-2 w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" /></svg>
                                –ò–∑—Ö–æ–¥
                            </button>
                        </div>
                    </div>
                `;
                } catch (e) {
                    console.error('Error parsing user:', e);
                    showLoginButtons();
                }
            } else {
                showLoginButtons();
            }

            function showLoginButtons() {
                headerRight.innerHTML = `
                <a href="/login" class="px-3.5 py-1.5 bg-white text-gray-700 border border-gray-300 rounded-lg font-semibold text-sm hover:bg-gray-50 transition-colors">
                    –í–ª–µ–∑
                </a>
                <a href="/register" class="px-3.5 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700 transition-all shadow-sm hover:shadow-md">
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </a>
            `;
            }

            // Toggle dropdown
            window.toggleDropdown = function (e) {
                e.stopPropagation();
                const menu = document.getElementById('dropdown-menu');
                menu.classList.toggle('hidden');
            };

            // Close dropdown when clicking outside
            document.addEventListener('click', function (e) {
                const dropdown = document.getElementById('profile-dropdown');
                const menu = document.getElementById('dropdown-menu');
                if (dropdown && menu && !dropdown.contains(e.target)) {
                    menu.classList.add('hidden');
                }
            });

            // Logout function
            window.logout = function () {
                localStorage.removeItem('user');
                localStorage.removeItem('token');
                localStorage.removeItem('idToken');
                localStorage.removeItem('firebaseToken');
                window.location.href = '/';
            };
        })();
    </script>

    <!-- Main Content -->
    <main class="container mx-auto max-w-4xl p-4 sm:p-6 lg:p-8 flex-1">
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-200">
            <!-- –ó–∞–≥–ª–∞–≤–∏–µ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∞ -->
            <div class="mb-8 pb-6 border-b border-gray-200">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">–ü–æ–¥–∞–π –Ω–æ–≤ —Å–∏–≥–Ω–∞–ª</h1>
                <p class="text-gray-600">–ü–æ–ø—ä–ª–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ-–¥–æ–ª—É –∑–∞ –¥–∞ –ø–æ–¥–∞–¥–µ—à —Å–∏–≥–Ω–∞–ª –∑–∞ –ø—Ä–æ–±–ª–µ–º –≤ –æ–±—â–∏–Ω–∞—Ç–∞</p>
            </div>

            <form class="space-y-6">

                <!-- –ó–∞–≥–ª–∞–≤–∏–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ -->
                <div>
                    <label for="signal-title"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z">
                            </path>
                        </svg>
                        –ó–∞–≥–ª–∞–≤–∏–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª–∞
                    </label>
                    <input type="text" id="signal-title"
                        class="w-full border-gray-300 rounded-lg shadow-sm focus:border-green-500 focus:ring-green-500 placeholder:text-gray-400 bg-gray-50 text-base py-2.5"
                        placeholder="–ù–∞–ø—Ä. '–ì–æ–ª—è–º–∞ –¥—É–ø–∫–∞ –Ω–∞ —É–ª. –•—Ä–∏—Å—Ç–æ –ë–æ—Ç–µ–≤'">
                </div>

                <!-- –¢–∏–ø –∏ –ù–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ (–Ω–∞ –µ–¥–∏–Ω —Ä–µ–¥) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- –¢–∏–ø –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è -->
                    <div>
                        <label for="signal-category" class="block text-sm font-medium text-gray-700 mb-2">–¢–∏–ø –Ω–∞
                            –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="signal-category"
                            class="w-full border-gray-300 rounded-lg shadow-sm focus:border-green-500 focus:ring-green-500 bg-gray-50 py-2.5">
                            <option value="">–ò–∑–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è...</option>
                            <option value="–ü–æ–∂–∞—Ä">üî• –ü–æ–∂–∞—Ä</option>
                            <option value="–í–∏–ö">üíß –í–∏–ö</option>
                            <option value="–¢–æ–∫">‚ö° –¢–æ–∫</option>
                            <option value="–ü—ä—Ç–∏—â–∞ –∏ —Ç—Ä–æ—Ç–æ–∞—Ä–∏">üõ£Ô∏è –ü—ä—Ç–∏—â–∞ –∏ —Ç—Ä–æ—Ç–æ–∞—Ä–∏</option>
                            <option value="–æ—Ç–ø–∞–¥—ä—Ü–∏">üóëÔ∏è –°–º–µ—Ç–∏—â–µ/–û—Ç–ø–∞–¥—ä—Ü–∏</option>
                            <option value="–û—Å–≤–µ—Ç–ª–µ–Ω–∏–µ">üí° –û—Å–≤–µ—Ç–ª–µ–Ω–∏–µ</option>
                            <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                            <option value="–®—É–º">üîä –®—É–º</option>
                            <option value="–î—Ä—É–≥–æ">üìå –î—Ä—É–≥–æ</option>
                        </select>
                    </div>

                    <!-- –ù–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ -->
                    <div>
                        <label for="signal-location" class="block text-sm font-medium text-gray-700 mb-2">–ù–∞—Å–µ–ª–µ–Ω–æ
                            –º—è—Å—Ç–æ</label>
                        <select id="signal-location"
                            class="w-full border-gray-300 rounded-lg shadow-sm focus:border-green-500 focus:ring-green-500 bg-gray-50 py-2.5">
                            <option value="" data-lat="" data-lng="">–ò–∑–±–µ—Ä–∏ –Ω–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ...</option>
                            <option value="–≥—Ä. –ë–æ—Ç–µ–≤–≥—Ä–∞–¥" data-lat="42.907600" data-lng="23.794300">–≥—Ä. –ë–æ—Ç–µ–≤–≥—Ä–∞–¥
                            </option>
                            <option value="—Å. –í—Ä–∞—á–µ—à" data-lat="42.891213" data-lng="23.747859">—Å. –í—Ä–∞—á–µ—à</option>
                            <option value="—Å. –¢—Ä—É–¥–æ–≤–µ—Ü" data-lat="42.916739" data-lng="23.843346">—Å. –¢—Ä—É–¥–æ–≤–µ—Ü</option>
                            <option value="—Å. –°–∫—Ä–∞–≤–µ–Ω–∞" data-lat="42.951819" data-lng="23.768394">—Å. –°–∫—Ä–∞–≤–µ–Ω–∞</option>
                            <option value="—Å. –õ–∏—Ç–∞–∫–æ–≤–æ" data-lat="42.951520" data-lng="23.675151">—Å. –õ–∏—Ç–∞–∫–æ–≤–æ</option>
                            <option value="—Å. –ù–æ–≤–∞—á–µ–Ω–µ" data-lat="42.977052" data-lng="23.729491">—Å. –ù–æ–≤–∞—á–µ–Ω–µ</option>
                            <option value="—Å. –ì—É—Ä–∫–æ–≤–æ" data-lat="42.976538" data-lng="23.688286">—Å. –ì—É—Ä–∫–æ–≤–æ</option>
                            <option value="—Å. –ë–æ–∂–µ–Ω–∏—Ü–∞" data-lat="43.009987" data-lng="23.815516">—Å. –ë–æ–∂–µ–Ω–∏—Ü–∞</option>
                            <option value="—Å. –†–∞–¥–æ—Ç–∏–Ω–∞" data-lat="42.992849" data-lng="23.636167">—Å. –†–∞–¥–æ—Ç–∏–Ω–∞</option>
                            <option value="—Å. –õ–∏–ø–Ω–∏—Ü–∞" data-lat="43.029245" data-lng="23.754662">—Å. –õ–∏–ø–Ω–∏—Ü–∞</option>
                            <option value="—Å. –ö—Ä–∞–µ–≤–æ" data-lat="42.982006" data-lng="23.607167">—Å. –ö—Ä–∞–µ–≤–æ</option>
                            <option value="—Å. –†–∞—à–∫–æ–≤–æ" data-lat="43.008994" data-lng="23.618046">—Å. –†–∞—à–∫–æ–≤–æ</option>
                            <option value="—Å. –ï–ª–æ–≤–¥–æ–ª" data-lat="43.041151" data-lng="23.771706">—Å. –ï–ª–æ–≤–¥–æ–ª</option>
                        </select>
                    </div>
                </div>

                <!-- –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–ê–¥—Ä–µ—Å) -->
                <div>
                    <label for="signal-address" class="block text-sm font-medium text-gray-700 mb-2">
                        –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–ø–æ –∏–∑–±–æ—Ä)
                    </label>
                    <input type="text" id="signal-address"
                        class="w-full border-gray-300 rounded-lg shadow-sm focus:border-green-500 focus:ring-green-500 placeholder:text-gray-400 bg-gray-50"
                        placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∞–¥—Ä–µ—Å, –∞–∫–æ –∂–µ–ª–∞–µ—Ç–µ...">
                    <p class="mt-2 text-xs text-gray-500 flex items-center gap-1">
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Å–µ –∏–∑–±–∏—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞ –ø–æ-–¥–æ–ª—É
                    </p>
                </div>

                <!-- –ö–∞—Ä—Ç–∞ –∑–∞ –∏–∑–±–æ—Ä -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        –ò–∑–±–µ—Ä–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
                    </label>
                    <div id="map-submit" class="w-full bg-gray-200 z-10 rounded-xl shadow-lg border-2 border-green-200">
                    </div>
                </div>

                <!-- –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ -->
                <div>
                    <label for="signal-description" class="block text-sm font-medium text-gray-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞
                        —Å–∏–≥–Ω–∞–ª–∞</label>
                    <textarea id="signal-description" rows="6"
                        class="w-full border-gray-300 rounded-lg shadow-sm focus:border-green-500 focus:ring-green-500 placeholder:text-gray-400 bg-gray-50"
                        placeholder="–û–ø–∏—à–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ä–æ–±–Ω–æ - –∫–æ–ª–∫–æ—Ç–æ –ø–æ–≤–µ—á–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —Ç–æ–ª–∫–æ–≤–∞ –ø–æ-–¥–æ–±—Ä–µ..."></textarea>
                    <p class="mt-2 text-xs text-gray-500">–û–ø–∏—à–µ—Ç–µ –ø—Ä–æ–±–ª–µ–º–∞ –≤—ä–∑–º–æ–∂–Ω–æ –Ω–∞–π-–ø–æ–¥—Ä–æ–±–Ω–æ</p>
                </div>

                <!-- –ö–∞—á–≤–∞–Ω–µ –Ω–∞ —Å–Ω–∏–º–∫–∏ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                        –°–Ω–∏–º–∫–∏ / –í–∏–¥–µ–æ (–ø–æ –∏–∑–±–æ—Ä)
                    </label>
                    <div id="drop-zone"
                        class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg bg-gray-50 hover:bg-gray-100 hover:border-green-400 transition-all duration-300 cursor-pointer transform hover:scale-[1.02]">
                        <div class="space-y-1 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400 transition-colors duration-300 drop-zone-icon"
                                stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                <path
                                    d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <div class="flex justify-center text-sm text-gray-600">
                                <label for="file-upload"
                                    class="relative cursor-pointer bg-white px-3 py-1 rounded-md font-medium text-green-600 hover:text-green-500 hover:bg-green-50 transition-all duration-200">
                                    <span>üìÅ –ò–∑–±–æ—Ä –Ω–∞ —Ñ–∞–π–ª</span>
                                    <input id="file-upload" name="file-upload" type="file" accept="image/*,video/*"
                                        class="hidden">
                                </label>
                            </div>
                            <p class="text-sm text-gray-500">–∏–ª–∏ –ø–ª—ä–∑–Ω–∏ –∏ –ø—É—Å–Ω–∏ —Ñ–∞–π–ª–∞ —Ç—É–∫</p>
                            <p class="text-xs text-gray-500 pt-2">üì∑ –°–Ω–∏–º–∫–∏ (PNG, JPG) ‚Ä¢ üé• –í–∏–¥–µ–æ (–¥–æ 15 —Å–µ–∫, MP4)</p>
                        </div>
                    </div>
                    <!-- –ü—Ä–µ–≤—é –Ω–∞ –∫–∞—á–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª–æ–≤–µ -->
                    <div id="media-preview" class="mt-4 hidden">
                        <div class="grid grid-cols-2 gap-4">
                            <div id="preview-container" class="col-span-2"></div>
                        </div>
                    </div>
                </div>

                <!-- –ê–Ω–æ–Ω–∏–º–µ–Ω —Å–∏–≥–Ω–∞–ª (–ü—Ä–µ–≤–∫–ª—é—á–≤–∞—Ç–µ–ª) -->
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                    <span class="text-sm font-medium text-gray-700">–ü–æ–¥–∞–π —Å–∏–≥–Ω–∞–ª–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ</span>
                    <label for="anonymous-toggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="anonymous-toggle" class="sr-only peer">
                        <div
                            class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-green-300 toggle-bg transition-colors">
                        </div>
                    </label>
                </div>

                <!-- –ë—É—Ç–æ–Ω –∑–∞ –∏–∑–ø—Ä–∞—â–∞–Ω–µ -->
                <div class="flex gap-4">
                    <button type="submit"
                        class="flex-1 flex justify-center items-center gap-2 py-3.5 px-4 border border-transparent rounded-lg shadow-md text-lg font-semibold text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all transform hover:scale-[1.02]">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                        –ü–æ–¥–∞–π —Å–∏–≥–Ω–∞–ª
                    </button>
                </div>

            </form>
        </div>
    </main>

    <!-- Video Trim Modal -->
    <div id="video-trim-modal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title"
        role="dialog" aria-modal="true">
        <!-- Backdrop —Å blur -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm transition-opacity"></div>

        <!-- Modal Container -->
        <div class="flex min-h-screen items-center justify-center p-4">
            <div
                class="relative transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all w-full max-w-3xl">

                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-green-600 to-green-500 px-5 py-3">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                            ‚úÇÔ∏è –ò–∑–±–µ—Ä–∏ 15 —Å–µ–∫—É–Ω–¥–∏ –æ—Ç –≤–∏–¥–µ–æ—Ç–æ
                        </h3>
                        <button type="button" onclick="closeVideoModal()"
                            class="text-white hover:text-gray-200 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="px-5 py-4 bg-gray-50">

                    <!-- Video Preview -->
                    <div class="mb-4 bg-black rounded-lg overflow-hidden shadow-lg">
                        <video id="modal-video-player" controls class="w-full h-56 object-contain">
                            <source src="" type="video/mp4">
                        </video>
                    </div>

                    <!-- Info Bar -->
                    <div
                        class="mb-4 flex items-center justify-between bg-yellow-50 border border-yellow-200 rounded-lg px-4 py-2">
                        <span class="text-sm text-yellow-800">
                            üìπ –í–∏–¥–µ–æ: <span id="modal-video-duration" class="font-bold">0</span>s
                        </span>
                        <span class="text-sm text-green-700 font-bold">
                            ‚úÇÔ∏è –ò–∑–±–æ—Ä: <span id="modal-selected-duration">15.0</span>s
                        </span>
                    </div>

                    <!-- Trim Controls -->
                    <div class="bg-white rounded-lg p-4 shadow border border-gray-200">

                        <!-- Visual Timeline -->
                        <div class="mb-4">
                            <div class="relative h-12 bg-gray-200 rounded-lg overflow-hidden">
                                <!-- Full video bar -->
                                <div class="absolute inset-0 flex items-center px-2">
                                    <span class="text-xs text-gray-500">0s</span>
                                    <span class="flex-1"></span>
                                    <span class="text-xs text-gray-500" id="full-duration">60s</span>
                                </div>
                                <!-- Selected range indicator -->
                                <div id="range-indicator"
                                    class="absolute top-0 bottom-0 bg-gradient-to-r from-green-400 to-blue-400 opacity-70"
                                    style="left: 0%; width: 25%;"></div>
                                <!-- Start marker -->
                                <div id="start-marker" class="absolute top-0 bottom-0 w-1 bg-green-600"
                                    style="left: 0%;"></div>
                                <!-- End marker -->
                                <div id="end-marker" class="absolute top-0 bottom-0 w-1 bg-blue-600" style="left: 25%;">
                                </div>
                            </div>
                            <div class="flex justify-between mt-1 text-xs text-gray-600">
                                <span>‚¨Ö –ù–∞—á–∞–ª–æ: <span id="timeline-start"
                                        class="font-bold text-green-600">0.0s</span></span>
                                <span>–ö—Ä–∞–π: <span id="timeline-end" class="font-bold text-blue-600">15.0s</span>
                                    ‚û°</span>
                            </div>
                        </div>

                        <!-- Start Slider -->
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-medium text-gray-700">üü¢ –ù–∞—á–∞–ª–æ:</label>
                                <span id="modal-start-display" class="text-sm font-bold text-green-600">0.0s</span>
                            </div>
                            <input type="range" id="modal-trim-start" min="0" max="60" step="0.1" value="0"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600"
                                oninput="updateModalTrim('start')">
                        </div>

                        <!-- End Slider -->
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-medium text-gray-700">üîµ –ö—Ä–∞–π:</label>
                                <span id="modal-end-display" class="text-sm font-bold text-blue-600">15.0s</span>
                            </div>
                            <input type="range" id="modal-trim-end" min="0" max="60" step="0.1" value="15"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                oninput="updateModalTrim('end')">
                        </div>

                        <!-- Preview Button -->
                        <button type="button" onclick="previewTrimmedSection()"
                            class="w-full py-2 px-4 bg-blue-100 text-blue-700 text-sm font-medium rounded-lg hover:bg-blue-200 transition-colors flex items-center justify-center gap-2">
                            ‚ñ∂Ô∏è –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –∏–∑–±—Ä–∞–Ω–æ—Ç–æ
                        </button>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="bg-gray-100 px-5 py-3 flex gap-2 justify-end">
                    <button type="button" onclick="closeVideoModal()"
                        class="px-4 py-2 bg-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-400 transition-colors">
                        ‚úó –û—Ç–∫–∞–∂–∏
                    </button>
                    <button type="button" onclick="confirmModalVideoTrim()"
                        class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors shadow-lg">
                        ‚úì –ü–æ—Ç–≤—ä—Ä–¥–∏
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto">
        <div
            class="container mx-auto max-w-7xl py-8 px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center text-sm text-gray-600">
            <div class="mb-4 md:mb-0">
                <span>Copyright ¬© 2025 –ú–æ—è—Ç –ë–æ—Ç–µ–≤–≥—Ä–∞–¥ –æ—Ç –î–ò–ú–ò–¢–†–ò –¢–ï–• –û–û–î.</span>
            </div>
            <div class="flex space-x-6">
                <a href="#" class="hover:text-green-600">–ê—Ä—Ö–∏–≤ —Å–∏–≥–Ω–∞–ª–∏</a>
                <a href="#" class="hover:text-green-600">–ó–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞</a>
                <a href="#" class="hover:text-green-600">–£—Å–ª–æ–≤–∏—è –∑–∞ –ø–æ–ª–∑–≤–∞–Ω–µ</a>
                <a href="#" class="hover:text-green-600">–ó–∞—â–∏—Ç–∞ –Ω–∞ –ª–∏—á–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏</a>
            </div>
        </div>
    </footer>

    <!-- Leaflet JS (–∑–∞ –∫–∞—Ä—Ç–∞—Ç–∞) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- JavaScript –∑–∞ –∫–∞—Ä—Ç–∞—Ç–∞ –Ω–∞ —Ç–∞–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <script>
        // ==========================================
        // –ì–õ–û–ë–ê–õ–ù–ò –§–£–ù–ö–¶–ò–ò (–ó–∞ –¥–æ—Å—Ç—ä–ø –æ—Ç HTML –±—É—Ç–æ–Ω–∏)
        // ==========================================

        // –ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –∑–∞ –º–µ–¥–∏—è —Ñ–∞–π–ª–æ–≤–µ—Ç–µ
        window.uploadedFile = null;
        window.tempVideoFile = null;
        window.tempVideoDuration = 0;

        // –ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –∑–∞ —Ç—Ä–∏–º–≤–∞–Ω–µ –Ω–∞ –≤–∏–¥–µ–æ
        let videoTrimStart = 0;
        let videoTrimEnd = 15;

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –∏–∑–±—Ä–∞–Ω–∏—è —Ñ–∞–π–ª
        window.removeMedia = function () {
            window.uploadedFile = null;
            videoTrimStart = 0;
            videoTrimEnd = 15;

            const fileInput = document.getElementById('file-upload');
            const mediaPreview = document.getElementById('media-preview');
            const previewContainer = document.getElementById('preview-container');

            if (fileInput) fileInput.value = '';
            if (previewContainer) previewContainer.innerHTML = '';
            if (mediaPreview) mediaPreview.classList.add('hidden');
        };

        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ –º–æ–¥–∞–ª–∞
        window.closeVideoModal = function () {
            const modal = document.getElementById('video-trim-modal');
            const videoPlayer = document.getElementById('modal-video-player');
            const fileInput = document.getElementById('file-upload');

            if (modal) modal.classList.add('hidden');

            if (videoPlayer) {
                videoPlayer.pause();
                videoPlayer.src = '';
            }

            // –ß–∏—Å—Ç–∏–º input-–∞, –∞–∫–æ –µ –æ—Ç–∫–∞–∑–∞–Ω–æ
            if (fileInput) fileInput.value = '';
            window.tempVideoFile = null;
        };

        // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å–ª–∞–π–¥–µ—Ä–∏—Ç–µ –≤ –º–æ–¥–∞–ª–∞
        window.updateModalTrim = function (movedSlider) {
            const startSlider = document.getElementById('modal-trim-start');
            const endSlider = document.getElementById('modal-trim-end');
            const videoPlayer = document.getElementById('modal-video-player');

            let startValue = parseFloat(startSlider.value);
            let endValue = parseFloat(endSlider.value);
            const duration = window.tempVideoDuration || 60;

            if (movedSlider === 'start') {
                endValue = startValue + 15;
                if (endValue > duration) {
                    endValue = duration;
                    startValue = endValue - 15;
                    startSlider.value = startValue;
                }
                endSlider.value = endValue;
            } else {
                startValue = endValue - 15;
                if (startValue < 0) {
                    startValue = 0;
                    endValue = 15;
                    endSlider.value = endValue;
                }
                startSlider.value = startValue;
            }

            // UI Updates
            document.getElementById('modal-start-display').textContent = startValue.toFixed(1) + 's';
            document.getElementById('modal-end-display').textContent = endValue.toFixed(1) + 's';
            document.getElementById('timeline-start').textContent = startValue.toFixed(1) + 's';
            document.getElementById('timeline-end').textContent = endValue.toFixed(1) + 's';
            document.getElementById('modal-selected-duration').textContent = (endValue - startValue).toFixed(1);

            // Visual Range
            const startPercent = (startValue / duration) * 100;
            const widthPercent = ((endValue - startValue) / duration) * 100;
            document.getElementById('range-indicator').style.left = startPercent + '%';
            document.getElementById('range-indicator').style.width = widthPercent + '%';
            document.getElementById('start-marker').style.left = startPercent + '%';
            document.getElementById('end-marker').style.left = (startPercent + widthPercent) + '%';

            // Global Update
            videoTrimStart = startValue;
            videoTrimEnd = endValue;

            if (videoPlayer) videoPlayer.currentTime = startValue;
        };

        // –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –æ—Ç—Ä—è–∑—ä–∫–∞
        window.previewTrimmedSection = function () {
            const videoPlayer = document.getElementById('modal-video-player');
            if (!videoPlayer) return;

            videoPlayer.currentTime = videoTrimStart;
            videoPlayer.play();

            const checkTime = setInterval(() => {
                if (videoPlayer.currentTime >= videoTrimEnd) {
                    videoPlayer.pause();
                    clearInterval(checkTime);
                }
            }, 100);
        };

        // –ü–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞–Ω–µ –Ω–∞ –≤–∏–¥–µ–æ—Ç–æ
        window.confirmModalVideoTrim = function () {
            window.uploadedFile = window.tempVideoFile;
            const previewContainer = document.getElementById('preview-container');
            const mediaPreview = document.getElementById('media-preview');
            const videoURL = URL.createObjectURL(window.uploadedFile);

            previewContainer.innerHTML = `
                <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl p-4 border-2 border-green-200 shadow-lg">
                    <div class="flex items-start gap-4">
                        <div class="w-48 h-32 bg-black rounded-lg overflow-hidden shadow-md flex-shrink-0 relative">
                            <video src="${videoURL}" class="w-full h-full object-contain" 
                                onloadedmetadata="this.currentTime=${videoTrimStart.toFixed(1)}">
                            </video>
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-2">
                                <p class="text-white text-xs font-bold">üé¨ ${videoTrimStart.toFixed(1)}s - ${videoTrimEnd.toFixed(1)}s</p>
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <p class="text-sm font-bold text-gray-800">üé• ${window.uploadedFile.name}</p>
                                <button type="button" onclick="removeMedia()" class="bg-red-500 text-white rounded-full p-1.5 hover:bg-red-600 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                            </div>
                            <div class="bg-white rounded-lg p-3 shadow-sm border border-green-200">
                                <p class="text-xs font-semibold text-green-700 mb-1">‚úÇÔ∏è –ò–ó–ë–†–ê–ù –û–¢–†–Ø–ó–™–ö: <span class="text-black font-normal">${videoTrimStart.toFixed(1)}s - ${videoTrimEnd.toFixed(1)}s</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            mediaPreview.classList.remove('hidden');

            // –ó–∞—Ç–≤–∞—Ä—è–º–µ –º–æ–¥–∞–ª–∞ —Ä—ä—á–Ω–æ, –±–µ–∑ –¥–∞ –≤–∏–∫–∞–º–µ –ø—ä–ª–Ω–∞—Ç–∞ closeVideoModal, –∑–∞ –¥–∞ –Ω–µ –∑–∞—Ç—Ä–∏–µ–º —Ñ–∞–π–ª–∞
            document.getElementById('video-trim-modal').classList.add('hidden');
            const vp = document.getElementById('modal-video-player');
            if (vp) { vp.pause(); vp.src = ''; }
        };

        // ==========================================
        // MAIN LOGIC (DOMContentLoaded)
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. –ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –∑–∞ –ö–∞—Ä—Ç–∞ –∏ –õ–æ–∫–∞—Ü–∏—è ---
            let map;
            let marker = null;
            let currentIcon = null;
            let isProgrammaticUpdate = false;

            // –ì–ª–æ–±–∞–ª–Ω–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∑–∞ —Ñ–æ—Ä–º–∞—Ç–∞
            let selectedLat = null;
            let selectedLng = null;

            const addressInput = document.getElementById('signal-address');
            const settlementSelect = document.getElementById('signal-location');
            const categorySelect = document.getElementById('signal-category');
            const form = document.querySelector('form');

            // --- 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –ö–∞—Ä—Ç–∞—Ç–∞ ---
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–∞ –ë–æ—Ç–µ–≤–≥—Ä–∞–¥: [42.906, 23.791]
            map = L.map('map-submit').setView([42.906, 23.791], 14);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // --- 3. –ü–æ–º–æ—â–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ –∏–∫–æ–Ω–∏ ---
            function createCustomIcon(category) {
                if (!category) return null;
                return L.icon({
                    iconUrl: `/pointers/${category}.png`,
                    iconSize: [30, 41],
                    iconAnchor: [15, 41],
                    popupAnchor: [0, -41]
                });
            }

            // --- 4. Event Listeners –∑–∞ UI –µ–ª–µ–º–µ–Ω—Ç–∏ ---

            // –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ –Ω–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ -> –¶–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞
            settlementSelect.addEventListener('change', function () {
                const selectedOption = this.options[this.selectedIndex];
                const lat = parseFloat(selectedOption.getAttribute('data-lat'));
                const lng = parseFloat(selectedOption.getAttribute('data-lng'));

                if (lat && lng) {
                    map.setView([lat, lng], 15);
                }
            });

            // –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è -> –°–º—è–Ω–∞ –Ω–∞ –∏–∫–æ–Ω–∞—Ç–∞
            categorySelect.addEventListener('change', function () {
                const selectedCategory = this.value;
                if (selectedCategory) {
                    currentIcon = createCustomIcon(selectedCategory);
                    if (marker) {
                        marker.setIcon(currentIcon);
                    }
                } else {
                    currentIcon = null;
                }
            });

            // --- 5. –õ–æ–≥–∏–∫–∞: –ö–ª–∏–∫ –≤—ä—Ä—Ö—É –∫–∞—Ä—Ç–∞—Ç–∞ (Reverse Geocoding) ---
            map.on('click', async function (e) {
                // –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ –∑–∞ submit
                selectedLat = e.latlng.lat;
                selectedLng = e.latlng.lng;

                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä–∞
                if (marker) {
                    map.removeLayer(marker);
                }
                const markerOptions = currentIcon ? { icon: currentIcon } : {};
                marker = L.marker(e.latlng, markerOptions).addTo(map);

                // UI feedback
                marker.bindPopup('<b>‚åõ –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∞–¥—Ä–µ—Å...</b>').openPopup();

                try {
                    // Reverse Geocode
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${selectedLat}&lon=${selectedLng}&accept-language=bg`);
                    const data = await response.json();

                    let addressText = `–õ–æ–∫–∞—Ü–∏—è: ${selectedLat.toFixed(5)}, ${selectedLng.toFixed(5)}`;

                    if (!data.error && data.address) {
                        addressText = [
                            data.address.road,
                            data.address.house_number,
                            data.address.suburb,
                            data.address.city || data.address.town || data.address.village
                        ].filter(Boolean).join(', ');
                    }

                    // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –ø–æ–ª–µ—Ç–æ (–±–ª–æ–∫–∏—Ä–∞–º–µ –æ–±—Ä–∞—Ç–Ω–∏—è loop)
                    if (addressInput) {
                        isProgrammaticUpdate = true;
                        addressInput.value = addressText;
                        addressInput.classList.add('bg-green-50');
                        setTimeout(() => addressInput.classList.remove('bg-green-50'), 1000);
                    }

                    // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ Popup-–∞
                    const cat = categorySelect.value || '–ù–µ –µ –∏–∑–±—Ä–∞–Ω–∞';
                    marker.setPopupContent(`<b>üìç –ò–∑–±—Ä–∞–Ω–∞ –ª–æ–∫–∞—Ü–∏—è</b><br>${addressText}<br><span class="text-xs text-gray-500">${cat}</span>`);

                } catch (error) {
                    console.error(error);
                    if (marker) marker.setPopupContent('<b>–ì—Ä–µ—à–∫–∞</b><br>–ù–µ—É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∞–¥—Ä–µ—Å');
                }
            });

            // --- 6. –õ–æ–≥–∏–∫–∞: –ü–∏—Å–∞–Ω–µ –Ω–∞ –∞–¥—Ä–µ—Å (Forward Geocoding) ---




            // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ç–µ–∫—Å—Ç–∞
            let addressDebounceTimer = null;
            let isSearching = false;

            function normalizeAddress(addr) {
                if (!addr) return '';
                return addr
                    .trim()
                    .replace(/["']/g, '')
                    .replace(/\s+/g, ' ')
                    .replace(/^(—É–ª\.?|—É–ª–∏—Ü–∞)\s+/i, '')
                    .trim();
            }

            async function handleAddressSearch() {
                if (isSearching || isProgrammaticUpdate) {
                    isProgrammaticUpdate = false;
                    return;
                }

                const rawAddress = addressInput.value.trim();
                const settlement = settlementSelect.value;

                if (!rawAddress || !settlement || rawAddress.length < 4) return;

                const normalized = normalizeAddress(rawAddress);
                const cleanSettlement = settlement.replace(/^(—Å\.|–≥—Ä\.)\s+/i, '').trim();

                const queries = [
                    `${normalized}, ${cleanSettlement}`,
                    `${normalized}, ${cleanSettlement}, –ë—ä–ª–≥–∞—Ä–∏—è`,
                    `${normalized}, –ë–æ—Ç–µ–≤–≥—Ä–∞–¥`
                ];


                addressInput.disabled = true;
                addressInput.placeholder = '–¢—ä—Ä—Å—è –∞–¥—Ä–µ—Å...';
                isSearching = true;
                try {
                    let data = null;

                    for (const q of queries) {
                        const res = await fetch(
                            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1&accept-language=bg&countrycodes=bg&viewbox=23.6,42.95,23.9,42.75&bounded=1`,
                            {
                                headers: {
                                    'User-Agent': 'BotevgradSignals/1.0'
                                }
                            }
                        );

                        const result = await res.json();

                        if (Array.isArray(result) && result.length > 0) {
                            data = result;
                            break;
                        }
                    }

                    if (!data) {
                        console.warn('–ê–¥—Ä–µ—Å—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω:', queries);
                        return;
                    }


                    const lat = parseFloat(data[0].lat);
                    const lng = parseFloat(data[0].lon);

                    selectedLat = lat;
                    selectedLng = lng;

                    if (marker) {
                        marker.setLatLng([lat, lng]);
                    } else {
                        marker = L.marker([lat, lng], currentIcon ? { icon: currentIcon } : {}).addTo(map);
                    }

                    map.setView([lat, lng], 16);

                    marker.bindPopup(`<b>üìç –ê–¥—Ä–µ—Å</b><br>${normalized}`).openPopup();

                } catch (err) {
                    console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Ç—ä—Ä—Å–µ–Ω–µ –Ω–∞ –∞–¥—Ä–µ—Å:', err);
                } finally {
                    addressInput.disabled = false;
                    addressInput.placeholder = '–í—ä–≤–µ–¥–µ—Ç–µ –∞–¥—Ä–µ—Å, –∞–∫–æ –∂–µ–ª–∞–µ—Ç–µ...';
                    isSearching = false;
                }
            }

            addressInput.addEventListener('input', () => {
                clearTimeout(addressDebounceTimer);
                addressDebounceTimer = setTimeout(handleAddressSearch, 1200);
            });

            // --- 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –§–∞–π–ª–æ–≤–µ (Drag & Drop + Input) ---
            const fileInput = document.getElementById('file-upload');
            const dropZone = document.getElementById('drop-zone');
            const previewContainer = document.getElementById('preview-container');
            const mediaPreview = document.getElementById('media-preview');

            fileInput.addEventListener('change', handleFileSelect);

            // Drag & Drop
            dropZone.addEventListener('click', (e) => {
                if (e.target.id !== 'file-upload') fileInput.click();
            });
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault(); e.stopPropagation();
                dropZone.classList.add('border-green-500', 'bg-green-50');
            });
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault(); e.stopPropagation();
                dropZone.classList.remove('border-green-500', 'bg-green-50');
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault(); e.stopPropagation();
                dropZone.classList.remove('border-green-500', 'bg-green-50');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files; // Works in modern browsers
                    handleFileSelect({ target: { files: files } });
                }
            });

            async function handleFileSelect(e) {
                const file = e.target.files[0];
                if (!file) return;

                const fileType = file.type.split('/')[0];
                if (fileType === 'image') {
                    handleImageUpload(file);
                } else if (fileType === 'video') {
                    handleVideoUpload(file);
                } else {
                    alert('–°–∞–º–æ —Å–Ω–∏–º–∫–∏ –∏ –≤–∏–¥–µ–æ!');
                }
            }

            function handleImageUpload(file) {
                window.uploadedFile = file;
                const reader = new FileReader();
                reader.onload = function (e) {
                    const size = (file.size / 1024).toFixed(1);
                    previewContainer.innerHTML = `
                        <div class="bg-gray-50 rounded-xl p-4 border border-gray-200 shadow flex gap-4">
                            <img src="${e.target.result}" class="w-24 h-24 object-cover rounded-lg">
                            <div class="flex-1">
                                <div class="flex justify-between">
                                    <span class="font-bold text-sm">${file.name}</span>
                                    <button type="button" onclick="removeMedia()" class="text-red-500">‚ùå</button>
                                </div>
                                <p class="text-xs text-gray-500">${size} KB</p>
                            </div>
                        </div>
                    `;
                    mediaPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }

            function handleVideoUpload(file) {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.onloadedmetadata = function () {
                    window.URL.revokeObjectURL(video.src);
                    const duration = video.duration;

                    if (duration > 15) {
                        // Open Editor
                        window.tempVideoFile = file;
                        window.tempVideoDuration = duration;

                        const modal = document.getElementById('video-trim-modal');
                        const vp = document.getElementById('modal-video-player');
                        vp.src = URL.createObjectURL(file);

                        // Reset UI
                        document.getElementById('modal-trim-start').max = Math.max(0, duration - 15);
                        document.getElementById('modal-trim-end').max = duration;
                        updateModalTrim('start'); // Reset sliders

                        document.getElementById('modal-video-duration').textContent = duration.toFixed(1);
                        modal.classList.remove('hidden');
                    } else {
                        // Direct upload
                        window.uploadedFile = file;
                        const url = URL.createObjectURL(file);
                        previewContainer.innerHTML = `
                             <div class="bg-green-50 rounded-xl p-4 border border-green-200 shadow flex gap-4">
                                <video src="${url}" class="w-24 h-24 object-cover rounded-lg"></video>
                                <div class="flex-1">
                                    <div class="flex justify-between">
                                        <span class="font-bold text-sm">${file.name}</span>
                                        <button type="button" onclick="removeMedia()" class="text-red-500">‚ùå</button>
                                    </div>
                                    <p class="text-xs text-green-600">–ì–æ—Ç–æ–≤–æ –∑–∞ –∫–∞—á–≤–∞–Ω–µ (${duration.toFixed(1)}s)</p>
                                </div>
                            </div>
                        `;
                        mediaPreview.classList.remove('hidden');
                    }
                };
                video.src = URL.createObjectURL(file);
            }


            // --- 8. Form Submit ---
            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                const title = document.getElementById('signal-title').value;
                const category = document.getElementById('signal-category').value;
                const district = document.getElementById('signal-location').value;
                let address = document.getElementById('signal-address').value;
                const description = document.getElementById('signal-description').value;

                // Validation
                if (!title || !category || !district || !description) {
                    alert('–ú–æ–ª—è, –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–æ–ª–µ—Ç–∞!');
                    return;
                }
                if (!selectedLat || !selectedLng) {
                    alert('–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞!');
                    return;
                }
                if (description.length < 10) {
                    alert('–û–ø–∏—Å–∞–Ω–∏–µ—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –ø–æ–Ω–µ 10 —Å–∏–º–≤–æ–ª–∞!');
                    return;
                }
                if (!address || address.trim() === '') address = '–Ω–µ –µ –æ–ø–∏—Å–∞–Ω–æ';

                // Data Prep
                const signalData = {
                    title,
                    description,
                    category,
                    district,
                    address,
                    latitude: selectedLat,
                    longitude: selectedLng,
                    hasMedia: window.uploadedFile !== null,
                    mediaName: window.uploadedFile ? window.uploadedFile.name : null,
                    videoTrim: (window.uploadedFile && window.uploadedFile.type.startsWith('video'))
                        ? { start: videoTrimStart, end: videoTrimEnd }
                        : null
                };

                // UI Loading
                const btn = form.querySelector('button[type="submit"]');
                const originalText = btn.textContent;
                btn.textContent = '–ü–æ–¥–∞–≤–∞–Ω–µ...';
                btn.disabled = true;

                try {
                    const res = await fetch('/api/signals', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(signalData)
                    });
                    console.log(signalData);

                    if (!res.ok) {
                        const err = await res.json();
                        throw new Error(err.error || '–ì—Ä–µ—à–∫–∞');
                    }

                    alert('–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∞–¥–µ–Ω —Å–∏–≥–Ω–∞–ª!');
                    window.location.href = '/signals';

                } catch (err) {
                    console.error(err);
                    alert('–ì—Ä–µ—à–∫–∞: ' + err.message);
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            });

        });

        // Logo Animation (Global)
        setInterval(() => {
            const logoSelnet = document.getElementById('logo-selnet');
            const logoBotevgrad = document.getElementById('logo-botevgrad');
            if (logoSelnet.style.opacity === '1') {
                logoSelnet.style.opacity = '0';
                logoBotevgrad.style.opacity = '1';
            } else {
                logoSelnet.style.opacity = '1';
                logoBotevgrad.style.opacity = '0';
            }
        }, 5000);
    </script>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto">
        <div
            class="container mx-auto max-w-7xl py-6 px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center text-sm text-gray-600">
            <div class="mb-4 md:mb-0 flex items-center gap-3">
                <img src="/logo-selnet-full.png" alt="–°–µ–ª–ù–µ—Ç" class="h-6 w-auto object-contain">
                <span class="text-gray-400">|</span>
                <span>¬© 2025 –î–ê–ù–¢–†–ò –¢–µ—Ö –û–û–î</span>
            </div>
            <nav class="flex flex-wrap justify-center md:justify-end gap-4 md:gap-6">
                <a href="/signals" class="hover:text-green-600 transition-colors">–ê—Ä—Ö–∏–≤ —Å–∏–≥–Ω–∞–ª–∏</a>
                <a href="/about" class="hover:text-green-600 transition-colors">–ó–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞</a>
                <a href="/terms" class="hover:text-green-600 transition-colors">–£—Å–ª–æ–≤–∏—è –∑–∞ –ø–æ–ª–∑–≤–∞–Ω–µ</a>
                <a href="/privacy" class="hover:text-green-600 transition-colors">–ó–∞—â–∏—Ç–∞ –Ω–∞ –¥–∞–Ω–Ω–∏</a>
                <a href="/contact" class="hover:text-green-600 transition-colors">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
            </nav>
        </div>
    </footer>

</body>

</html>
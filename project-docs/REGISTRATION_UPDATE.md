# üîê –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

## –î–∞—Ç–∞: 2025-10-22

---

## üìã –ù–∞–ø—Ä–∞–≤–µ–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏

### ‚úÖ 1. –û–ø—Ä–æ—Å—Ç–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏

**–ü—Ä–µ–¥–∏:**
- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ –∏–∑–±–∏—Ä–∞—Ö–∞ —Ä–æ–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- –ú–æ–∂–µ—Ö–∞ –¥–∞ —Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞—Ç –∫–∞—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, –æ–±—â–∏–Ω—Å–∫–∏ —Å–ª—É–∂–∏—Ç–µ–ª –∏–ª–∏ –∞–¥–º–∏–Ω
- –†–∏—Å–∫ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–∞ —Å –ø—Ä–∞–≤–∞

**–°–µ–≥–∞:**
- ‚úÖ –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç –∏–∑–±–æ—Ä –Ω–∞ —Ä–æ–ª—è –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—Ç–∞ —Ñ–æ—Ä–º–∞
- ‚úÖ –í—Å–∏—á–∫–∏ –Ω–æ–≤–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ª—É—á–∞–≤–∞—Ç —Ä–æ–ª—è **"resident" (–ñ–∏—Ç–µ–ª)**
- ‚úÖ –ü–æ-–ø—Ä–æ—Å—Ç–∞ –∏ –ø–æ-—Å–∏–≥—É—Ä–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

---

### ‚úÖ 2. –ê–¥–º–∏–Ω—Å–∫–∏ –ø–∞–Ω–µ–ª –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–æ–ª–∏

**–õ–æ–∫–∞—Ü–∏—è:** `/admin/users`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –≤—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ç–µ–∫—É—â–∞—Ç–∞ —Ä–æ–ª—è —Å —Ü–≤–µ—Ç–Ω–∏ badge-–æ–≤–µ
- ‚úÖ –ë—É—Ç–æ–Ω–∏ –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Ä–æ–ª—è (—Å–∞–º–æ –∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∏)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–µ–Ω –±–ª–æ–∫ —Å –æ–±—è—Å–Ω–µ–Ω–∏–µ –Ω–∞ –≤—Å—è–∫–∞ —Ä–æ–ª—è
- ‚úÖ –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ UI

**–î–æ—Å—Ç—ä–ø:**
- –°–∞–º–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Å —Ä–æ–ª—è **"admin"** –∏–º–∞—Ç –¥–æ—Å—Ç—ä–ø
- –î—Ä—É–≥–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –≤–∏–∂–¥–∞—Ç —Å—ä–æ–±—â–µ–Ω–∏–µ "–î–æ—Å—Ç—ä–ø –æ—Ç–∫–∞–∑–∞–Ω"

---

## üéØ –†–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞

### üè† –ñ–∏—Ç–µ–ª (resident)
- **–ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –∑–∞ –≤—Å–∏—á–∫–∏ –Ω–æ–≤–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏**
- –ú–æ–∂–µ –¥–∞ –ø–æ–¥–∞–≤–∞ —Å–∏–≥–Ω–∞–ª–∏, –∏–¥–µ–∏ –∏ —Å—ä–±–∏—Ç–∏—è
- –ú–æ–∂–µ –¥–∞ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞ –∏ –≥–ª–∞—Å—É–≤–∞
- –ú–æ–∂–µ –¥–∞ —Å–µ –∑–∞–ø–∏—Å–≤–∞ –∑–∞ —Å—ä–±–∏—Ç–∏—è (RSVP)

### üë• –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä (coordinator)
- –ú–æ–∂–µ –¥–∞ –º–æ–¥–µ—Ä–∏—Ä–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ
- –ú–æ–∂–µ –¥–∞ –ø—Ä–æ–º–µ–Ω—è —Å—Ç–∞—Ç—É—Å–∏ –Ω–∞ —Å–∏–≥–Ω–∞–ª–∏
- –†–∞–±–æ—Ç–∏ –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –æ–±—Ö–≤–∞—Ç (scopes)
- –ó–∞–¥–∞–≤–∞ —Å–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

### üèõÔ∏è –û–±—â–∏–Ω—Å–∫–∏ —Å–ª—É–∂–∏—Ç–µ–ª (municipal)
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ –ø—Ä–∞–≤–∞ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –ú–æ–∂–µ –¥–∞ –º–æ–¥–µ—Ä–∏—Ä–∞ –≤ —Ü—è–ª–∞—Ç–∞ –æ–±—â–∏–Ω–∞
- –ü–æ-—à–∏—Ä–æ–∫ –æ–±—Ö–≤–∞—Ç –æ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
- –ó–∞–¥–∞–≤–∞ —Å–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

### ‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (admin)
- –ü—ä–ª–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–æ —Å–∏—Å—Ç–µ–º–∞—Ç–∞
- –ú–æ–∂–µ –¥–∞ —É–ø—Ä–∞–≤–ª—è–≤–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∏ —Ä–æ–ª–∏
- –ú–æ–∂–µ –¥–∞ –ø—Ä–æ–º–µ–Ω—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ó–∞–¥–∞–≤–∞ —Å–µ —Ä—ä—á–Ω–æ –≤ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏ –∏–ª–∏ –æ—Ç –¥—Ä—É–≥ –∞–¥–º–∏–Ω

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–µ—Ç–∞–π–ª–∏

### –ü—Ä–æ–º–µ–Ω–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:

1. **`src/lib/schemas/register.ts`**
   - –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–æ –ø–æ–ª–µ `role` –æ—Ç —Å—Ö–µ–º–∞—Ç–∞ –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
   - –û–ø—Ä–æ—Å—Ç–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ

2. **`src/app/(auth)/register/register-form.tsx`**
   - –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç UI –∑–∞ –∏–∑–±–æ—Ä –Ω–∞ —Ä–æ–ª—è
   - –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–∏ –∏–º–ø–æ—Ä—Ç–∏ –∑–∞ `ROLE_LABELS` –∏ `ROLE_ORDER`
   - –ü–æ-—á–∏—Å—Ç–∞ –∏ –ø–æ-–ø—Ä–æ—Å—Ç–∞ —Ñ–æ—Ä–º–∞

3. **`src/app/api/auth/register/route.ts`**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–¥–∞–≤–∞–Ω–µ –Ω–∞ `role = "resident"`
   - –ö–æ–º–µ–Ω—Ç–∞—Ä –∑–∞ —è—Å–Ω–æ—Ç–∞ –≤ –∫–æ–¥–∞

4. **`src/app/admin/users/page.tsx`**
   - –ü–æ–¥–æ–±—Ä–µ–Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å –±—ä–ª–≥–∞—Ä—Å–∫–∏ –µ—Ç–∏–∫–µ—Ç–∏
   - –¶–≤–µ—Ç–Ω–∏ badge-–æ–≤–µ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏—Ç–µ —Ä–æ–ª–∏
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–µ–Ω –±–ª–æ–∫ —Å –æ–±—è—Å–Ω–µ–Ω–∏—è
   - –ü–æ-–¥–æ–±—ä—Ä UX –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Ä–æ–ª–∏

---

## üöÄ –ö–∞–∫ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—à –Ω–æ–≤–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞

### –ó–∞ –æ–±–∏–∫–Ω–æ–≤–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏:

1. –û—Ç–∏–¥–∏ –Ω–∞ `/register`
2. –ü–æ–ø—ä–ª–Ω–∏ –∏–º–µ, –∏–º–µ–π–ª –∏ –ø–∞—Ä–æ–ª–∞
3. –ü—Ä–∏–µ–º–∏ —É—Å–ª–æ–≤–∏—è—Ç–∞ –∑–∞ –ø–æ–ª–∑–≤–∞–Ω–µ
4. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π —Å–µ
5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ª—É—á–∞–≤–∞—à —Ä–æ–ª—è "–ñ–∏—Ç–µ–ª"

### –ó–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∏:

1. –í–ª–µ–∑ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∫–∞—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –û—Ç–∏–¥–∏ –Ω–∞ `/admin/users`
3. –í–∏–∂ —Å–ø–∏—Å—ä–∫ —Å –≤—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
4. –ö–ª–∏–∫–Ω–∏ –Ω–∞ –±—É—Ç–æ–Ω–∞ —Å –∂–µ–ª–∞–Ω–∞—Ç–∞ —Ä–æ–ª—è –∑–∞ –¥–∞–¥–µ–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
5. –†–æ–ª—è—Ç–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è –≤–µ–¥–Ω–∞–≥–∞

---

## üîí –°–∏–≥—É—Ä–Ω–æ—Å—Ç

### –ó–∞—â–∏—Ç–∞ –Ω–∞ API:
- ‚úÖ –°–∞–º–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –º–æ–≥–∞—Ç –¥–∞ –ø—Ä–æ–º–µ–Ω—è—Ç —Ä–æ–ª–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∞—Ç–∞ –≤ `/api/admin/users/set-role`
- ‚úÖ Firebase Admin SDK –≤–∞–ª–∏–¥–∏—Ä–∞ —Å–µ—Å–∏—è—Ç–∞
- ‚úÖ Custom claims —Å–µ –æ–±–Ω–æ–≤—è–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

### Firestore Rules:
```javascript
match /users/{uid} {
  allow read, update: if request.auth != null && request.auth.uid == uid;
  allow create, delete: if false;
}
```

---

## üìù –ó–∞–±–µ–ª–µ–∂–∫–∏

### –í–∞–∂–Ω–æ:
- –°–ª–µ–¥ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Ä–æ–ª—è, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –º–æ–∂–µ –¥–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ **—Ä–µ—Ñ—Ä–µ—à–Ω–µ —Å–µ—Å–∏—è—Ç–∞ —Å–∏**
- –ü—Ä–æ–º–µ–Ω–∏—Ç–µ –≤ custom claims —Å–µ –ø—Ä–∏–ª–∞–≥–∞—Ç –ø—Ä–∏ —Å–ª–µ–¥–≤–∞—â login
- –ó–∞ –Ω–µ–∑–∞–±–∞–≤–Ω–æ –ø—Ä–∏–ª–∞–≥–∞–Ω–µ, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–∑–ª–µ–∑–µ –∏ –¥–∞ –≤–ª–µ–∑–µ –æ—Ç–Ω–æ–≤–æ

### –ü—Ä–µ–ø–æ—Ä—ä–∫–∏:
- –ó–∞–¥–∞–≤–∞–π —Ä–æ–ª–∏ —Å–∞–º–æ –Ω–∞ –¥–æ–≤–µ—Ä–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∏—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞—Ç –∑–∞–¥–∞–¥–µ–Ω–∏ scopes (–Ω–∞—Å–µ–ª–µ–Ω–æ –º—è—Å—Ç–æ/–æ–±—â–∏–Ω–∞)
- –†–µ–¥–æ–≤–Ω–æ –ø—Ä–µ–≥–ª–µ–∂–¥–∞–π —Å–ø–∏—Å—ä–∫–∞ —Å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∏ —Ç–µ—Ö–Ω–∏—Ç–µ —Ä–æ–ª–∏

---

## üé® UI –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è

### –¶–≤–µ—Ç–æ–≤–∞ —Å—Ö–µ–º–∞ –∑–∞ —Ä–æ–ª–∏:
- üè† **–ñ–∏—Ç–µ–ª**: –°–∏–≤ badge (`bg-gray-100`)
- üë• **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä**: –°–∏–Ω badge (`bg-blue-100`)
- üèõÔ∏è **–û–±—â–∏–Ω—Å–∫–∏ —Å–ª—É–∂–∏—Ç–µ–ª**: –õ–∏–ª–∞–≤ badge (`bg-purple-100`)
- ‚öôÔ∏è **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**: –ß–µ—Ä–≤–µ–Ω badge (`bg-red-100`)

### –ë—É—Ç–æ–Ω–∏ –∑–∞ –ø—Ä–æ–º—è–Ω–∞:
- –ê–∫—Ç–∏–≤–Ω–∞—Ç–∞ —Ä–æ–ª—è –µ —Å—ä—Å –∑–µ–ª–µ–Ω —Ñ–æ–Ω (`bg-emerald-600`)
- –ù–µ–∞–∫—Ç–∏–≤–Ω–∏—Ç–µ —Ä–æ–ª–∏ —Å–∞ —Å –±—è–ª —Ñ–æ–Ω –∏ hover –µ—Ñ–µ–∫—Ç
- Disabled —Å—ä—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–µ—Ç–æ—Å—Ç

---

## ‚úÖ –¢–µ—Å—Ç–≤–∞–Ω–µ

### –¢–µ—Å—Ç–≤–∞–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è—Ç–∞:
1. –û—Ç–≤–æ—Ä–∏ `/register`
2. –ü–æ–ø—ä–ª–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∏ —á–µ –Ω—è–º–∞ –ø–æ–ª–µ –∑–∞ –∏–∑–±–æ—Ä –Ω–∞ —Ä–æ–ª—è
4. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π —Å–µ
5. –ü—Ä–æ–≤–µ—Ä–∏ –≤ `/me` —á–µ —Ä–æ–ª—è—Ç–∞ –µ "resident"

### –¢–µ—Å—Ç–≤–∞–π –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∞:
1. –í–ª–µ–∑ –∫–∞—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –û—Ç–≤–æ—Ä–∏ `/admin/users`
3. –í–∏–∂ —Å–ø–∏—Å—ä–∫–∞ —Å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
4. –ü—Ä–æ–º–µ–Ω–∏ —Ä–æ–ª—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
5. –ü—Ä–æ–≤–µ—Ä–∏ —á–µ –ø—Ä–æ–º—è–Ω–∞—Ç–∞ —Å–µ –æ—Ç—Ä–∞–∑—è–≤–∞ –≤–µ–¥–Ω–∞–≥–∞

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏

–ê–∫–æ –∏–º–∞—à —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –±–µ–∑ —Ä–æ–ª—è:

```javascript
// Firestore Console –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
db.collection('users').get().then(snapshot => {
  snapshot.forEach(doc => {
    if (!doc.data().role) {
      doc.ref.update({ role: 'resident' });
    }
  });
});
```

---

## üìû –ü–æ–¥–¥—Ä—ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∏:
1. –ü—Ä–æ–≤–µ—Ä–∏ –∫–æ–Ω–∑–æ–ª–∞—Ç–∞ –∑–∞ –≥—Ä–µ—à–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏ Firebase Auth custom claims
3. –ü—Ä–æ–≤–µ—Ä–∏ Firestore –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
4. –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –∞–¥–º–∏–Ω—ä—Ç –∏–º–∞ –ø—Ä–∞–≤–∏–ª–Ω–∞ —Ä–æ–ª—è

---

**–ì–æ—Ç–æ–≤–æ!** –°–∏—Å—Ç–µ–º–∞—Ç–∞ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –µ –æ–ø—Ä–æ—Å—Ç–µ–Ω–∞ –∏ –ø–æ-—Å–∏–≥—É—Ä–Ω–∞. üéâ

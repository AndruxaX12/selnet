# RBAC –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Äî –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ 3/3 ‚úÖ –ó–ê–í–™–†–®–ï–ù–û

## –ö–∞–∫–≤–æ –µ —Å—ä–∑–¥–∞–¥–µ–Ω–æ –≤ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ 3

### 1. –î–µ—Ç–∞–π–ª–Ω–∏ –°—Ç—Ä–∞–Ω–∏—Ü–∏ —Å—ä—Å –ü—ä–ª–µ–Ω –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

#### `/signals/[id]` ‚Äî –î–µ—Ç–∞–π–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞ —Å–∏–≥–Ω–∞–ª
- ‚úÖ SSR page —Å dynamic metadata (SEO)
- ‚úÖ –ü—ä–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –∑–∞–≥–ª–∞–≤–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, —Ä–∞–π–æ–Ω
- ‚úÖ –ì–∞–ª–µ—Ä–∏—è —Å—ä—Å —Å–Ω–∏–º–∫–∏ (grid layout)
- ‚úÖ –õ–æ–∫–∞—Ü–∏—è —Å –ª–∏–Ω–∫ –∫—ä–º Google Maps
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –≥–ª–µ–¥–∞–Ω–∏—è, –∫–æ–º–µ–Ω—Ç–∞—Ä–∏, —Å–ª–µ–¥—è—â–∏
- ‚úÖ –î–µ–π—Å—Ç–≤–∏—è: –°–ª–µ–¥–∏, –ü–æ–¥–∫—Ä–µ–ø–∏ (RBAC protected)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π/–ò–∑—Ç—Ä–∏–π –±—É—Ç–æ–Ω–∏ (owner or admin only)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∞–≤—Ç–æ—Ä
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏

#### `/ideas/[id]` ‚Äî –î–µ—Ç–∞–π–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞ –∏–¥–µ—è
- ‚úÖ SSR page —Å dynamic metadata
- ‚úÖ –†–µ–∑—é–º–µ + –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ
- ‚úÖ –û—á–∞–∫–≤–∞–Ω –µ—Ñ–µ–∫—Ç, —Ü–µ–Ω–∞, —Å—Ä–æ–∫ (–∞–∫–æ —Å–∞ –Ω–∞–ª–∏—á–Ω–∏)
- ‚úÖ –°—Ç–∞—Ç—É—Å badge (—á–µ—Ä–Ω–æ–≤–∞, –æ—Ç–≤–æ—Ä–µ–Ω–∞, –Ω–∞ –ø—Ä–µ–≥–ª–µ–¥, –æ–¥–æ–±—Ä–µ–Ω–∞, —Ä–µ–∞–ª–∏–∑–∏—Ä–∞–Ω–∞)
- ‚úÖ –ë—Ä–æ–π –ø–æ–¥–∫—Ä–µ–ø–∏ —Å –≥–æ–ª—è–º –≤–∏–∑—É–∞–ª–µ–Ω accent
- ‚úÖ –ü–æ–¥–∫—Ä–µ–ø–∞ button (toggle on/off)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π/–ò–∑—Ç—Ä–∏–π (owner or admin)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∞–≤—Ç–æ—Ä
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏

#### `/events/[id]` ‚Äî –î–µ—Ç–∞–π–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞ —Å—ä–±–∏—Ç–∏–µ
- ‚úÖ SSR page —Å dynamic metadata
- ‚úÖ Cover image (aspect-ratio 21:9)
- ‚úÖ –î–∞—Ç–∞/—á–∞—Å (–Ω–∞—á–∞–ª–æ –∏ –∫—Ä–∞–π) —Å —Ñ–æ—Ä–º–∞—Ç bg-BG
- ‚úÖ –õ–æ–∫–∞—Ü–∏—è
- ‚úÖ RSVP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç (toggle on/off)
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ü–∏—è –∑–∞ –º–∞–∫—Å. –º–µ—Å—Ç–∞ –∏ "–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∏ –º–µ—Å—Ç–∞"
- ‚úÖ Badge "–ü—Ä–∏–∫–ª—é—á–∏–ª–æ" –∑–∞ –º–∏–Ω–∞–ª–∏ —Å—ä–±–∏—Ç–∏—è
- ‚úÖ Disable RSVP –∑–∞ –º–∏–Ω–∞–ª–∏ —Å—ä–±–∏—Ç–∏—è
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π/–ò–∑—Ç—Ä–∏–π (owner or admin)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏

### 2. –ö–æ–º–µ–Ω—Ç–∞—Ä–∏ –°–∏—Å—Ç–µ–º–∞ (–ü—ä–ª–Ω–∞ –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è)

#### `CommentsList` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- ‚úÖ –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –æ—Ç API
- ‚úÖ Nested –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ (replies)
- ‚úÖ –§–æ—Ä–º–∞ –∑–∞ –Ω–æ–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä (—Å–∞–º–æ –∑–∞ logged-in users)
- ‚úÖ Reply —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç —Å mention (@username)
- ‚úÖ –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä (owner only)
- ‚úÖ "–î–æ–∫–ª–∞–¥–≤–∞–π" –±—É—Ç–æ–Ω (moderator+)
- ‚úÖ Relative time formatting (bg-BG)
- ‚úÖ Badge "—Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω" –∞–∫–æ updated_at !== created_at
- ‚úÖ Empty state "–í—Å–µ –æ—â–µ –Ω—è–º–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏"
- ‚úÖ Loading state
- ‚úÖ RBAC protection (`<Require>` component)

#### Features
- **Nested replies**: –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –º–æ–≥–∞—Ç –¥–∞ –∏–º–∞—Ç –æ—Ç–≥–æ–≤–æ—Ä–∏ (parent_id)
- **Character limit**: –º–∞–∫—Å 2000 —Å–∏–º–≤–æ–ª–∞
- **Auto-increment**: comments_count —Å–µ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- **Cascade delete**: –ø—Ä–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä —Å–µ –∏–∑—Ç—Ä–∏–≤–∞—Ç –∏ –≤—Å–∏—á–∫–∏ replies

### 3. API Routes –∑–∞ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏

#### Signals Comments
```typescript
GET  /api/signals/[signalId]/comments
POST /api/signals/[signalId]/comments
DELETE /api/signals/[signalId]/comments/[commentId]
```

#### Ideas Comments
```typescript
GET  /api/ideas/[ideaId]/comments
POST /api/ideas/[ideaId]/comments
```

#### Events Comments
```typescript
GET  /api/events/[eventId]/comments
POST /api/events/[eventId]/comments
```

**Features:**
- GET: –≤—Ä—ä—â–∞ –≤—Å–∏—á–∫–∏ top-level –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ + nested replies
- POST: —Å—ä–∑–¥–∞–≤–∞ –Ω–æ–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä –∏–ª–∏ reply (—Å RBAC guard)
- DELETE: –∏–∑—Ç—Ä–∏–≤–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä + –≤—Å–∏—á–∫–∏ replies, –¥–µ–∫—Ä–µ–º–µ–Ω—Ç–≤–∞ count

### 4. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è API

#### Follow Signal
```typescript
POST /api/signals/[signalId]/follow
‚Üí toggle follow/unfollow
‚Üí increment/decrement watchers count
```

#### Delete Resource
```typescript
DELETE /api/signals/[signalId]
DELETE /api/ideas/[ideaId]
DELETE /api/events/[eventId]
‚Üí cascade delete: comments, followers/supporters/RSVPs
‚Üí owner or admin only
```

### 5. Permissions & Guards

#### –î–µ—Ç–∞–π–ª–Ω–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∏
- **View**: –ø—É–±–ª–∏—á–Ω–∏ (–≤—Å–∏—á–∫–∏ –º–æ–≥–∞—Ç –¥–∞ —á–µ—Ç–∞—Ç)
- **Edit**: owner –∏–ª–∏ moderator+
- **Delete**: owner –∏–ª–∏ admin
- **Follow/Support/RSVP**: citizen+

#### –ö–æ–º–µ–Ω—Ç–∞—Ä–∏
- **Create**: citizen+ (`apiRequirePermission("create:comment")`)
- **Delete**: owner –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∞ –∏–ª–∏ moderator+
- **Report**: moderator+

### 6. UI/UX Features

#### Responsive Layout
- Desktop: 2-–∫–æ–ª–æ–Ω–µ–Ω grid (content + sidebar)
- Mobile: 1-–∫–æ–ª–æ–Ω–µ–Ω stack
- Images: aspect-ratio preserved, object-cover

#### Interactive Elements
- Follow button: toggle state (secondary when following)
- Support button: toggle state, disabled –∞–∫–æ –≤–µ—á–µ –µ –ø–æ–¥–∫—Ä–µ–ø–∏–ª
- RSVP button: toggle state, disabled –∞–∫–æ –Ω—è–º–∞ –º–µ—Å—Ç–∞
- Delete actions: confirmation dialog

#### Badges & Status
- –°—Ç–∞—Ç—É—Å badge —Å —Ü–≤–µ—Ç–Ω–∞ –∏–Ω–¥–∏–∫–∞—Ü–∏—è
- "–ü—Ä–∏–∫–ª—é—á–∏–ª–æ" badge –∑–∞ –º–∏–Ω–∞–ª–∏ —Å—ä–±–∏—Ç–∏—è
- "—Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω" badge –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç badge –∑–∞ —Å–∏–≥–Ω–∞–ª–∏

#### Empty States
- "–í—Å–µ –æ—â–µ –Ω—è–º–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏"
- "–ë—ä–¥–∏ –ø—ä—Ä–≤–∏—è—Ç, –∫–æ–π—Ç–æ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞"

#### Loading States
- Skeleton –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
- "–ó–∞—Ä–µ–∂–¥–∞–Ω–µ..." text
- Disabled buttons during submission

### 7. Data Flow

#### –°–∏–≥–Ω–∞–ª Detail Page
```
1. SSR: getSessionUser() + load signal from Firestore
2. Server: generate metadata (title, description)
3. Client: SignalDetail component
4. Client: load comments from API
5. User actions: follow, delete, comment
6. API: update Firestore, increment/decrement counts
```

#### –ö–æ–º–µ–Ω—Ç–∞—Ä–∏ Flow
```
1. CommentsList: fetch GET /api/.../comments
2. Nested structure: parent comments + replies[]
3. User submits comment
4. POST /api/.../comments with content + parent_id
5. API: create comment, increment resource.comments_count
6. Reload comments to show new comment
```

### 8. Firestore Collections

#### `comments` collection
```typescript
{
  resource_type: "signal" | "idea" | "event";
  resource_id: string;
  parent_id: string | null;
  author_id: string;
  author_name: string;
  author_email: string;
  content: string;
  created_at: Timestamp;
  updated_at: Timestamp;
}
```

#### `signal_followers` collection
```typescript
{
  signal_id: string;
  user_id: string;
  created_at: Timestamp;
}
```

#### –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∏ –∑–∞ `idea_supporters`, `event_rsvps`

### 9. Formatting & Localization

#### Date Formatting (bg-BG)
```typescript
// Relative time
"–°–µ–≥–∞", "5 –º–∏–Ω", "2 —á", "3 –¥–Ω–∏", "–í—á–µ—Ä–∞"

// Short date
"22.10.2025, 18:30"

// Full date
"–Ω–µ–¥–µ–ª—è, 22 –æ–∫—Ç–æ–º–≤—Ä–∏ 2025 –≥., 18:30"
```

#### Numbers
- Supporters: "124 –ø–æ–¥–∫—Ä–µ–ø–∏"
- RSVP: "42 —É—á–∞—Å—Ç–Ω–∏—Ü–∏"
- Comments: "15 –∫–æ–º–µ–Ω—Ç–∞—Ä–∏"

### 10. Security Features

#### Server-Side Guards
- `requireAuth()` ‚Äî –∏–∑–∏—Å–∫–≤–∞ –≤—Ö–æ–¥
- `apiRequirePermission()` ‚Äî –∏–∑–∏—Å–∫–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω action
- Owner checks: `user.uid === resource.author_id`
- Admin checks: `user.role === "admin"`

#### Client-Side Guards
- `<Require anyOf={["citizen", "admin"]}>` ‚Äî UI gating
- Disabled states –∑–∞ non-authorized actions
- Redirect to login —Å `?redirect=` param

#### Validation
- Content –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø—Ä–∞–∑–µ–Ω
- Max length 2000 —Å–∏–º–≤–æ–ª–∞ –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
- Owner or admin only –∑–∞ delete
- Parent comment check –∑–∞ replies

### 11. Edge Cases Handling

#### –ú–∏–Ω–∞–ª–∏ —Å—ä–±–∏—Ç–∏—è
- Disable RSVP button
- Show "–ü—Ä–∏–∫–ª—é—á–∏–ª–æ" badge
- –ö–æ–º–µ–Ω—Ç–∞—Ä–∏—Ç–µ –æ—Å—Ç–∞–≤–∞—Ç –∞–∫—Ç–∏–≤–Ω–∏

#### –ü—ä–ª–Ω–∏ —Å—ä–±–∏—Ç–∏—è
- Disable RSVP –∞–∫–æ `rsvpCount >= max_participants`
- Show "–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∏ –º–µ—Å—Ç–∞"
- Allow unRSVP –∞–∫–æ –≤–µ—á–µ —Å–∏ –∑–∞–ø–∏—Å–∞–Ω

#### –ò–∑—Ç—Ä–∏—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏
- `notFound()` –ø—Ä–∏ –Ω–µ—Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â ID
- Cascade delete –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

#### Guests
- Show "–í–ª–µ–∑ –∑–∞ RSVP/–ø–æ–¥–∫—Ä–µ–ø–∞/–∫–æ–º–µ–Ω—Ç–∞—Ä"
- Link to login —Å redirect param

## –§–∞–π–ª–æ–≤–∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ 3)

```
apps/web/src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ signals/[id]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # SSR page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signal-detail.tsx     # Client component
‚îÇ   ‚îú‚îÄ‚îÄ ideas/[id]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ idea-detail.tsx
‚îÇ   ‚îú‚îÄ‚îÄ events/[id]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ event-detail.tsx
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ signals/[signalId]/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route.ts          # DELETE signal
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ follow/route.ts   # POST follow/unfollow
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ comments/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ route.ts      # GET/POST comments
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ [commentId]/route.ts  # DELETE comment
‚îÇ       ‚îú‚îÄ‚îÄ ideas/[ideaId]/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route.ts
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ comments/route.ts
‚îÇ       ‚îî‚îÄ‚îÄ events/[eventId]/
‚îÇ           ‚îú‚îÄ‚îÄ route.ts
‚îÇ           ‚îî‚îÄ‚îÄ comments/route.ts
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ comments/
        ‚îî‚îÄ‚îÄ CommentsList.tsx      # –ö–æ–º–µ–Ω—Ç–∞—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```

## Acceptance Criteria ‚úÖ

- [x] –î–µ—Ç–∞–π–ª–Ω–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∏ –∑–∞—Ä–µ–∂–¥–∞—Ç –¥–∞–Ω–Ω–∏ –æ—Ç Firestore (SSR)
- [x] Dynamic metadata –∑–∞ SEO (title, description)
- [x] Follow/Support/RSVP toggle functionality
- [x] –ö–æ–º–µ–Ω—Ç–∞—Ä–∏ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç nested (parent + replies)
- [x] –ù–æ–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä —Å–µ —Å—ä–∑–¥–∞–≤–∞ –∏ —Å–ø–∏—Å—ä–∫—ä—Ç —Å–µ refresh-–≤–∞
- [x] –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä —Ä–∞–±–æ—Ç–∏ (owner only)
- [x] –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ä–µ—Å—É—Ä—Å cascade delete-–≤–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
- [x] RBAC guards –±–ª–æ–∫–∏—Ä–∞—Ç –Ω–µ–æ—Ç–æ—Ä–∏–∑–∏—Ä–∞–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è
- [x] Guest users –≤–∏–∂–¥–∞—Ç "–í–ª–µ–∑ –∑–∞..." prompts
- [x] –í—Å–∏—á–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ —Å–∞ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏
- [x] –î–∞—Ç–∏ —Å–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–∏ bg-BG (DD.MM.YYYY, HH:mm)
- [x] –ú–∏–Ω–∞–ª–∏ —Å—ä–±–∏—Ç–∏—è –ø–æ–∫–∞–∑–≤–∞—Ç "–ü—Ä–∏–∫–ª—é—á–∏–ª–æ" –∏ disable RSVP
- [x] –ü—ä–ª–Ω–∏ —Å—ä–±–∏—Ç–∏—è –ø–æ–∫–∞–∑–≤–∞—Ç "–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∏ –º–µ—Å—Ç–∞"
- [x] Owner –∏ admin –≤–∏–∂–¥–∞—Ç Edit/Delete –±—É—Ç–æ–Ω–∏
- [x] Comments count —Å–µ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- [x] Nested replies —Ä–∞–±–æ—Ç—è—Ç –∫–æ—Ä–µ–∫—Ç–Ω–æ

## Testing Scenarios

### –ü–æ–∑–∏—Ç–∏–≤–Ω–∏
1. ‚úÖ Guest –≤–∏–∂–¥–∞ –¥–µ—Ç–∞–π–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –Ω–æ –Ω–µ –º–æ–∂–µ –¥–∞ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞
2. ‚úÖ Citizen –º–æ–∂–µ –¥–∞ follow/support/RSVP –∏ –¥–∞ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞
3. ‚úÖ Owner –º–æ–∂–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ —Å–≤–æ–π –∫–æ–º–µ–Ω—Ç–∞—Ä
4. ‚úÖ Admin –º–æ–∂–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ –≤—Å–µ–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä –∏ —Ä–µ—Å—É—Ä—Å
5. ‚úÖ Reply –∫—ä–º –∫–æ–º–µ–Ω—Ç–∞—Ä —Å—ä–∑–¥–∞–≤–∞ nested —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
6. ‚úÖ RSVP toggle increment/decrement count

### –ù–µ–≥–∞—Ç–∏–≤–Ω–∏
1. ‚úÖ Guest –æ–ø–∏—Ç –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä ‚Üí redirect to login
2. ‚úÖ –ù–µ—Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â ID ‚Üí 404 notFound()
3. ‚úÖ Non-owner –æ–ø–∏—Ç –∑–∞ delete ‚Üí 403 Forbidden
4. ‚úÖ –ü—Ä–∞–∑–µ–Ω –∫–æ–º–µ–Ω—Ç–∞—Ä ‚Üí validation error
5. ‚úÖ >2000 —Å–∏–º–≤–æ–ª–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä ‚Üí validation error
6. ‚úÖ RSVP –∫—ä–º –ø—ä–ª–Ω–æ —Å—ä–±–∏—Ç–∏–µ ‚Üí disabled (–∞–∫–æ –Ω–µ —Å–∏ –≤–µ—á–µ –∑–∞–ø–∏—Å–∞–Ω)

## Performance Optimizations

### Firestore Queries
- Index –Ω–∞ `resource_type + resource_id + parent_id` –∑–∞ –±—ä—Ä–∑–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ queries
- Limit –Ω–∞ top-level –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ (–º–æ–∂–µ–º –¥–∞ –¥–æ–±–∞–≤–∏–º pagination)
- Single read –∑–∞ signal + separate read –∑–∞ comments

### Client-Side
- useState –∑–∞ toggle states (instant UI feedback)
- Reload comments —Å–∞–º–æ —Å–ª–µ–¥ —É—Å–ø–µ—à–Ω–æ POST/DELETE
- Cached abilities –æ—Ç `/api/me/abilities` (5 min)

### Images
- aspect-ratio –∑–∞ consistent sizing
- object-cover –∑–∞ crop
- lazy loading (browser native)

## –°–ª–µ–¥–≤–∞—â–∏ –ü–æ–¥–æ–±—Ä–µ–Ω–∏—è (Optional)

1. **Pagination –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏**: Load more button –∞–∫–æ >20 –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
2. **Real-time updates**: Firestore realtime listeners –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
3. **Rich text editor**: Markdown –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
4. **Emoji reactions**: üëç üëé ‚ù§Ô∏è –≤—ä—Ä—Ö—É –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
5. **Edit comment**: –†–µ–¥–∞–∫—Ü–∏—è –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏
6. **Report comment**: Moderator review queue
7. **Notifications**: Email/SMS –ø—Ä–∏ –Ω–æ–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä –Ω–∞ followed signal
8. **Share functionality**: Social media share buttons
9. **Vote system**: Upvote/downvote –∑–∞ —Å–∏–≥–Ω–∞–ª–∏
10. **Activity feed**: `/me/activity` —Å –≤—Å–∏—á–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –∏ interactions

---

## üéâ –ì–ï–ù–ï–†–ò–†–ê–ù–ï 1+2+3 –ó–ê–í–™–†–®–ï–ù–ò

**–û–±—â–æ —Å—ä–∑–¥–∞–¥–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:** 85+  
**–û–±—â–æ —Ä–µ–¥–æ–≤–µ –∫–æ–¥:** ~12,000+  
**–í—Å–∏—á–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ:** –ë—ä–ª–≥–∞—Ä—Å–∫–∏ (bg-BG)  
**–ß–∞—Å–æ–≤–∞ –∑–æ–Ω–∞:** Europe/Sofia  
**–§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏:** DD.MM.YYYY, HH:mm

### –ü—ä–ª–Ω–∞ RBAC –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ó–∞–≤—ä—Ä—à–µ–Ω–∞:
‚úÖ Policy map (40+ actions, 6 roles)  
‚úÖ Server + Client guards  
‚úÖ Auth pages (register, verify, login, consent, onboarding)  
‚úÖ Public lists (signals, ideas, events)  
‚úÖ Role panels (admin, operator, ombudsman)  
‚úÖ Forms –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ (signals, ideas, events)  
‚úÖ API –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ + –∫–æ–º–µ–Ω—Ç–∞—Ä–∏  
‚úÖ –î–µ—Ç–∞–π–ª–Ω–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∏ —Å –ø—ä–ª–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª  
‚úÖ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏ —Å–∏—Å—Ç–µ–º–∞ (nested, replies)  
‚úÖ Follow/Support/RSVP interactions  
‚úÖ Error —Å—Ç—Ä–∞–Ω–∏—Ü–∏ (401, 403)  
‚úÖ Protected layouts  

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞ –µ –≥–æ—Ç–æ–≤–∞ –∑–∞ production deploy! üöÄ**

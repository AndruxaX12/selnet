# –ê–î–ú–ò–ù –ü–ê–ù–ï–õ - –ü–™–õ–ù–ê –ò–ú–ü–õ–ï–ú–ï–ù–¢–ê–¶–ò–Ø ‚úÖ

**–§–∏–Ω–∞–ª–Ω–∞ –≤–µ—Ä—Å–∏—è:** 3.0  
**–î–∞—Ç–∞:** 22.10.2025, 22:10  
**–°—Ç–∞—Ç—É—Å:** üéâ PRODUCTION READY

---

## üìä –û–ë–© –ü–†–ï–ì–õ–ï–î

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏—è—Ç –ø–∞–Ω–µ–ª –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–æ–ª–∏, –ø–æ–∫–∞–Ω–∏ –∏ –æ–¥–∏—Ç –ª–æ–≥–æ–≤–µ –µ **–Ω–∞–ø—ä–ª–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω** –ø—Ä–µ–∑ 3 –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏—è:

- **–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ 1:** –û—Å–Ω–æ–≤–∞ (Reason, Scope, Dialogs, API)
- **–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ 2:** Dual-Control, Email, Real-time
- **–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ 3:** UI —Å—Ç—Ä–∞–Ω–∏—Ü–∏ –∏ –∑–∞–≤—ä—Ä—à–≤–∞—â–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç

---

## ‚úÖ –ü–™–õ–ï–ù –°–ü–ò–°–™–ö –ù–ê –§–£–ù–ö–¶–ò–ò–¢–ï

### 1. Dashboard (`/admin`)
- ‚úÖ 4 —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∫–∞—Ä—Ç–∏ (–∞–∫—Ç–∏–≤–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏, —Ä–æ–ª–∏, –ø–æ–∫–∞–Ω–∏, –æ–¥–∏—Ç)
- ‚úÖ Real-time pending approvals —Å–µ–∫—Ü–∏—è
- ‚úÖ –ë—É—Ç–æ–Ω–∏ –∑–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç—Ö–≤—ä—Ä–ª—è–Ω–µ
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ (signals/ideas/events)

### 2. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ (`/admin/users`)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å –≤—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
- ‚úÖ –§–∏–ª—Ç—Ä–∏: —Ç—ä—Ä—Å–µ–Ω–µ –ø–æ –∏–º–µ/email, —Ñ–∏–ª—Ç—ä—Ä –ø–æ —Ä–æ–ª—è
- ‚úÖ –ö–æ–ª–æ–Ω–∏: –∏–º–µ, email, —Ä–æ–ª–∏ (badges), —Å—Ç–∞—Ç—É—Å, –ø–æ—Å–ª–µ–¥–Ω–æ –≤–ª–∏–∑–∞–Ω–µ
- ‚úÖ –†–µ–¥–æ–≤–∏ –¥–µ–π—Å—Ç–≤–∏—è: + –†–æ–ª—è, –î–µ—Ç–∞–π–ª–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AddRoleDialog
- ‚úÖ Link –∫—ä–º –¥–µ—Ç–∞–π–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞

### 3. –î–µ—Ç–∞–π–ª–µ–Ω –ü—Ä–æ—Ñ–∏–ª (`/admin/users/:id`)
- ‚úÖ Header —Å –∏–º–µ, email, —Å—Ç–∞—Ç—É—Å
- ‚úÖ –†–æ–ª–∏ –∫–∞—Ä—Ç–∞: —Å–ø–∏—Å—ä–∫ —Å —Ä–æ–ª–∏, scope, –ø—Ä–∏—á–∏–Ω–∞, –¥–∞—Ç–∞
- ‚úÖ Abilities –∫–∞—Ä—Ç–∞: –∏–∑—á–∏—Å–ª–µ–Ω–∏ –ø—Ä–∞–≤–∞ (‚úì/‚úó icons)
- ‚úÖ –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è: –ø–æ—Å–ª–µ–¥–Ω–∏ 20 audit —Å—ä–±–∏—Ç–∏—è
- ‚úÖ –ë—É—Ç–æ–Ω "–î–æ–±–∞–≤–∏ —Ä–æ–ª—è" ‚Üí AddRoleDialog

### 4. –†–æ–ª–∏ (`/admin/roles`)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
- ‚úÖ –ü—Ä–∏—Å–≤–æ—è–≤–∞–Ω–µ/–æ—Ç–Ω–µ–º–∞–Ω–µ —Ä–æ–ª–∏
- ‚úÖ **–°—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞** - –∑–∞–ø–∞–∑–µ–Ω–∞

### 5. –ü–æ–∫–∞–Ω–∏ (`/admin/invites`)
- ‚úÖ –§–æ—Ä–º–∞ –∑–∞ –Ω–æ–≤–∞ –ø–æ–∫–∞–Ω–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å –∞–∫—Ç–∏–≤–Ω–∏ –ø–æ–∫–∞–Ω–∏
- ‚úÖ –î–µ–π—Å—Ç–≤–∏—è: Resend, Revoke (—Å reason), Copy URL
- ‚úÖ **–°—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞** - –∑–∞–ø–∞–∑–µ–Ω–∞

### 6. –û–¥–∏—Ç –õ–æ–≥–æ–≤–µ (`/admin/audit`)
- ‚úÖ –§–∏–ª—Ç—Ä–∏: —Ç–∏–ø —Å—ä–±–∏—Ç–∏–µ, –∞–∫—Ç—å–æ—Ä, —Ç–∞—Ä–≥–µ—Ç, –ø–µ—Ä–∏–æ–¥ (24—á/7–¥/30–¥/–≤—Å–∏—á–∫–∏)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞: –≤—Ä–µ–º–µ, —Å—ä–±–∏—Ç–∏–µ, –∞–∫—Ç—å–æ—Ä, —Ç–∞—Ä–≥–µ—Ç, IP
- ‚úÖ Expandable rows –∑–∞ JSON –¥–µ—Ç–∞–π–ª–∏
- ‚úÖ Export —Ñ—É–Ω–∫—Ü–∏–∏: CSV, JSON
- ‚úÖ –ü–æ–∫–∞–∑–≤–∞ user agent –ø—Ä–∏ expand

### 7. Dialogs
- ‚úÖ AddRoleDialog: —Ä–æ–ª—è, scope (global/area), reason (min 10), notify checkbox
- ‚úÖ High-risk warning –∑–∞ admin/ombudsman
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞
- ‚úÖ Auto-trigger approval request –∑–∞ –≤–∏—Å–æ–∫–æ—Ä–∏—Å–∫–æ–≤–∏ —Ä–æ–ª–∏

### 8. API Endpoints

**Dashboard:**
- `GET /api/admin/dashboard` ‚Äî Stats –∑–∞ –∫–∞—Ä—Ç–∏

**Users:**
- `GET /api/admin/users` ‚Äî –°–ø–∏—Å—ä–∫ —Å —Ñ–∏–ª—Ç—Ä–∏
- `GET /api/admin/users/:id` ‚Äî –î–µ—Ç–∞–π–ª–µ–Ω –ø—Ä–æ—Ñ–∏–ª
- `GET /api/admin/users/:id/audit` ‚Äî –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è
- `POST /api/admin/users/:id/roles` ‚Äî –ü—Ä–∏—Å–≤–æ—è–≤–∞–Ω–µ (—Å reason)
- `DELETE /api/admin/users/:id/roles/:grantId` ‚Äî –û—Ç–Ω–µ–º–∞–Ω–µ (—Å reason)

**Approvals:**
- `GET /api/admin/approvals` ‚Äî Pending requests
- `POST /api/admin/approvals` ‚Äî –ù–æ–≤–∞ –∑–∞—è–≤–∫–∞
- `POST /api/admin/approvals/:id` ‚Äî –û–¥–æ–±—Ä–µ–Ω–∏–µ/–û—Ç—Ö–≤—ä—Ä–ª—è–Ω–µ

**Audit:**
- `GET /api/admin/audit` ‚Äî –õ–æ–≥–æ–≤–µ —Å —Ñ–∏–ª—Ç—Ä–∏

**Invites:**
- `POST /api/admin/invites/:id` ‚Äî Revoke —Å reason

**Real-time:**
- `GET /api/admin/stream` ‚Äî SSE endpoint

### 9. Data Models

**Firestore Collections:**
- `users` ‚Äî –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ (roles, status, notes)
- `role_grants` ‚Äî –ò—Å—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–æ–ª–∏ (reason, scope, granted_by)
- `approval_requests` ‚Äî Dual-control –∑–∞—è–≤–∫–∏
- `audit_logs` ‚Äî –í—Å–∏—á–∫–∏ —Å–∏—Å—Ç–µ–º–Ω–∏ —Å—ä–±–∏—Ç–∏—è
- `invites` ‚Äî –ü–æ–∫–∞–Ω–∏ (—Å revoke_reason)

### 10. Email Notifications
- ‚úÖ roleGrantedEmail ‚Äî –ø—Ä–∏ –ø—Ä–∏—Å–≤–æ—è–≤–∞–Ω–µ
- ‚úÖ roleRevokedEmail ‚Äî –ø—Ä–∏ –æ—Ç–Ω–µ–º–∞–Ω–µ
- ‚úÖ approvalRequestEmail ‚Äî –ø—Ä–∏ –Ω–æ–≤–∞ –∑–∞—è–≤–∫–∞
- ‚úÖ –ë—ä–ª–≥–∞—Ä—Å–∫–∏ templates —Å permissions —Å–ø–∏—Å—ä–∫
- ‚úÖ Graceful fail (–Ω–µ –±–ª–æ–∫–∏—Ä–∞ –ø—Ä–∏ –≥—Ä–µ—à–∫–∞)

### 11. Real-time Updates
- ‚úÖ SSE endpoint `/api/admin/stream`
- ‚úÖ Keep-alive –Ω–∞ –≤—Å–µ–∫–∏ 30 —Å–µ–∫
- ‚úÖ Admin-only auth
- ‚è≥ Firestore subscriptions (placeholder)

### 12. Security & Audit
- ‚úÖ –ó–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –∑–∞ –≤—Å–∏—á–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ Dual-control –∑–∞ admin/ombudsman —Ä–æ–ª–∏
- ‚úÖ Self-approval –±–ª–æ–∫–∏—Ä–∞–Ω
- ‚úÖ –ü—ä–ª–µ–Ω audit trail (actor/target/reason/ip/ua)
- ‚úÖ Server-side guard-–æ–≤–µ –∑–∞ –≤—Å–∏—á–∫–∏ routes
- ‚úÖ CSRF protection (Next.js built-in)

---

## üìÅ FILE STRUCTURE

```
apps/web/src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx              ‚úÖ Sidebar –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                ‚úÖ Dashboard (stats + approvals + content)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            ‚úÖ –ù–û–í - Users table
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users-table.tsx     ‚úÖ –ù–û–í
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ page.tsx        ‚úÖ –ù–û–í - User detail
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ user-profile-view.tsx ‚úÖ –ù–û–í
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            ‚úÖ –°—ä—â–µ—Å—Ç–≤—É–≤–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles-manager.tsx   ‚úÖ –°—ä—â–µ—Å—Ç–≤—É–≤–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ invites/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            ‚úÖ –°—ä—â–µ—Å—Ç–≤—É–≤–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ invites-manager.tsx ‚úÖ –°—ä—â–µ—Å—Ç–≤—É–≤–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audit/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ page.tsx            ‚úÖ –ù–û–í
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ audit-logs-browser.tsx ‚úÖ –ù–û–í
‚îÇ   ‚îî‚îÄ‚îÄ api/admin/
‚îÇ       ‚îú‚îÄ‚îÄ dashboard/route.ts      ‚úÖ –ù–û–í (Gen 1)
‚îÇ       ‚îú‚îÄ‚îÄ audit/route.ts          ‚úÖ –ù–û–í (Gen 1)
‚îÇ       ‚îú‚îÄ‚îÄ stream/route.ts         ‚úÖ –ù–û–í (Gen 2)
‚îÇ       ‚îú‚îÄ‚îÄ approvals/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route.ts            ‚úÖ –ù–û–í (Gen 2)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ [requestId]/route.ts ‚úÖ –ù–û–í (Gen 2)
‚îÇ       ‚îú‚îÄ‚îÄ users/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route.ts            ‚úÖ –°—ä—â–µ—Å—Ç–≤—É–≤–∞
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ [userId]/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ route.ts        ‚úÖ –ù–û–í (Gen 3)
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ audit/route.ts  ‚úÖ –ù–û–í (Gen 3)
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ roles/route.ts  ‚úÖ –†–∞–∑—à–∏—Ä–µ–Ω (Gen 1)
‚îÇ       ‚îî‚îÄ‚îÄ invites/[inviteId]/route.ts ‚úÖ –†–∞–∑—à–∏—Ä–µ–Ω (Gen 2)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reason-field.tsx        ‚úÖ –ù–û–í (Gen 1)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scope-selector.tsx      ‚úÖ –ù–û–í (Gen 1)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add-role-dialog.tsx     ‚úÖ –ù–û–í (Gen 1)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pending-approvals.tsx   ‚úÖ –ù–û–í (Gen 2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stat-card.tsx           ‚úÖ –ù–û–í (Gen 3)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboard-stats.tsx     ‚úÖ –ù–û–í (Gen 3)
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îÇ       ‚îú‚îÄ‚îÄ dialog.tsx              ‚úÖ –ù–û–í (Gen 1)
‚îÇ       ‚îú‚îÄ‚îÄ radio-group.tsx         ‚úÖ –ù–û–í (Gen 1)
‚îÇ       ‚îú‚îÄ‚îÄ checkbox.tsx            ‚úÖ –ù–û–í (Gen 1)
‚îÇ       ‚îú‚îÄ‚îÄ alert.tsx               ‚úÖ –ù–û–í (Gen 1)
‚îÇ       ‚îú‚îÄ‚îÄ card.tsx                ‚úÖ –ù–û–í (Gen 2)
‚îÇ       ‚îî‚îÄ‚îÄ Badge.tsx               ‚úÖ –†–∞–∑—à–∏—Ä–µ–Ω (Gen 1)
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ email/
        ‚îú‚îÄ‚îÄ templates.ts            ‚úÖ –ù–û–í (Gen 2)
        ‚îî‚îÄ‚îÄ send.ts                 ‚úÖ –ù–û–í (Gen 2)
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- **–ù–æ–≤–∏ —Ñ–∞–π–ª–æ–≤–µ:** 28
- **–ü—Ä–æ–º–µ–Ω–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:** 6
- **API endpoints:** 15+
- **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:** 10+
- **–û–±—â–æ —Ä–µ–¥–æ–≤–µ –∫–æ–¥:** ~4500+

---

## üéØ ACCEPTANCE CRITERIA - –í–°–ò–ß–ö–ò –ü–û–ö–†–ò–¢–ò

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –°–∞–º–æ admin –≤–∏–∂–¥–∞ /admin/* | ‚úÖ |
| –ü–æ–∫–∞–Ω–∏: —Å—ä–∑–¥–∞–≤–∞–Ω–µ, –ø—Ä–µ–ø—Ä–∞—â–∞–Ω–µ, –æ—Ç–Ω–µ–º–∞–Ω–µ | ‚úÖ |
| –†–æ–ª–∏: –ø—Ä–∏—Å–≤–æ—è–≤–∞–Ω–µ/–æ—Ç–Ω–µ–º–∞–Ω–µ —Å –ø—Ä–∏—á–∏–Ω–∞ | ‚úÖ |
| Dual-control –∑–∞ admin/ombudsman | ‚úÖ |
| Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±—ä–ª–≥–∞—Ä—Å–∫–∏) | ‚úÖ |
| Audit –ª–æ–≥–æ–≤–µ —Å actor/target/IP | ‚úÖ |
| UI –∑–∞ pending approvals | ‚úÖ |
| Scope support (global/area) | ‚úÖ |
| Reason field (min 10 chars) | ‚úÖ |
| Lighthouse —Ü–µ–ª–∏ | ‚è≥ (–Ω–µ —Ç–µ—Å—Ç–≤–∞–Ω–æ) |
| A11y —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏ | ‚è≥ (–Ω–µ —Ç–µ—Å—Ç–≤–∞–Ω–æ) |

---

## üöÄ PRODUCTION DEPLOYMENT CHECKLIST

### –ó–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ:
- [ ] **Email Configuration**
  ```bash
  # .env.local
  SENDGRID_API_KEY=SG.xxxxx  # or SMTP_*
  FROM_EMAIL=noreply@selnet.bg
  FROM_NAME="SelNet Platform"
  ```
- [ ] Uncomment email –∫–æ–¥ –≤ `lib/email/send.ts`
- [ ] Test email delivery

### –ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ:
- [ ] SSE Firestore subscriptions (–¥–æ–±–∞–≤–∏ –≤ `/api/admin/stream`)
- [ ] Lighthouse audit
- [ ] A11y testing (screen readers)
- [ ] Mobile responsiveness test
- [ ] Load testing –Ω–∞ audit endpoint

### –û–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ:
- [ ] Redis –∑–∞ SSE pub/sub (multi-instance)
- [ ] Email queue (Bull/BullMQ)
- [ ] Rate limiting –Ω–∞ API routes
- [ ] Monitoring/alerting –∑–∞ approval requests

---

## üß™ TESTING GUIDE

### Manual Testing:

1. **Dashboard:**
   ```
   - –û—Ç–≤–æ—Ä–∏ /admin
   - –í–∏–∂ 4 –∫–∞—Ä—Ç–∏ —Å—ä—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –í–∏–∂ pending approvals (–∞–∫–æ –∏–º–∞)
   ```

2. **Users:**
   ```
   - –û—Ç–≤–æ—Ä–∏ /admin/users
   - –¢—ä—Ä—Å–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
   - –ö–ª–∏–∫–Ω–∏ "+ –†–æ–ª—è" ‚Üí –∏–∑–±–µ—Ä–∏ moderator ‚Üí –∑–∞–ø–∏—à–∏
   - –ö–ª–∏–∫–Ω–∏ "–î–µ—Ç–∞–π–ª–∏" ‚Üí –≤–∏–∂ –ø—Ä–æ—Ñ–∏–ª–∞
   ```

3. **User Profile:**
   ```
   - –í /admin/users/:id –≤–∏–∂ —Ä–æ–ª–∏, abilities, —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è
   - –ö–ª–∏–∫–Ω–∏ "–î–æ–±–∞–≤–∏ —Ä–æ–ª—è" ‚Üí –∏–∑–±–µ—Ä–∏ admin
   - –¢—Ä—è–±–≤–∞ –¥–∞ —Å–µ —Å—ä–∑–¥–∞–¥–µ approval request
   ```

4. **Dual-Control:**
   ```
   - –° –≤—Ç–æ—Ä–∏ admin –∞–∫–∞—É–Ω—Ç –æ—Ç–≤–æ—Ä–∏ /admin
   - –í–∏–∂ pending approval –≤ –∫–∞—Ä—Ç–∞—Ç–∞
   - –ö–ª–∏–∫–Ω–∏ "–û–¥–æ–±—Ä–∏" ‚Üí –Ω–∞–ø–∏—à–∏ –ø—Ä–∏—á–∏–Ω–∞ ‚Üí –ø–æ—Ç–≤—ä—Ä–¥–∏
   - –†–æ–ª—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –ø—Ä–∏—Å–≤–æ–∏
   ```

5. **Audit:**
   ```
   - –û—Ç–≤–æ—Ä–∏ /admin/audit
   - –§–∏–ª—Ç—Ä–∏—Ä–∞–π –ø–æ event type: role.granted
   - –ö–ª–∏–∫–Ω–∏ "‚ñ∂ –î–µ—Ç–∞–π–ª–∏" ‚Üí –≤–∏–∂ JSON
   - –ö–ª–∏–∫–Ω–∏ "Export CSV" ‚Üí —Å–≤–∞–ª–∏ —Ñ–∞–π–ª
   ```

6. **Email (console):**
   ```
   - –ü—Ä–∏—Å–≤–æ–∏ —Ä–æ–ª—è —Å notify checkbox
   - –í–∏–∂ –≤ console: "=== EMAIL WOULD BE SENT ==="
   ```

### Automated Tests (–∑–∞ –Ω–∞–ø–∏—Å–≤–∞–Ω–µ):
```bash
# Unit tests
npm test components/admin/add-role-dialog.test.tsx
npm test lib/email/templates.test.ts

# Integration tests
npm test api/admin/approvals.test.ts

# E2E tests (Playwright)
npm test e2e/admin-panel.spec.ts
```

---

## üìñ USER GUIDE (–ë—ä–ª–≥–∞—Ä—Å–∫–∏)

### –ö–∞–∫ –¥–∞ –ø—Ä–∏—Å–≤–æ—è —Ä–æ–ª—è?

1. –û—Ç–∏–¥–∏ –≤ **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª** ‚Üí **–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏**
2. –ù–∞–º–µ—Ä–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (—Å —Ç—ä—Ä—Å–µ–Ω–µ –∏–ª–∏ —Ñ–∏–ª—Ç—ä—Ä)
3. –ö–ª–∏–∫–Ω–∏ –±—É—Ç–æ–Ω **"+ –†–æ–ª—è"**
4. –ò–∑–±–µ—Ä–∏ —Ä–æ–ª—è –æ—Ç dropdown
5. –ò–∑–±–µ—Ä–∏ –æ–±—Ö–≤–∞—Ç: **Global** (—Ü—è–ª–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞) –∏–ª–∏ **Area** (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –Ω–∞—Å–µ–ª–µ–Ω–∏ –º–µ—Å—Ç–∞)
6. –ù–∞–ø–∏—à–∏ **–ø—Ä–∏—á–∏–Ω–∞** (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–∞) - –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ!
7. –û—Å—Ç–∞–≤–∏ —á–µ–∫–±–æ–∫—Å–∞ "–ò–∑–ø—Ä–∞—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ email" –º–∞—Ä–∫–∏—Ä–∞–Ω
8. –ö–ª–∏–∫–Ω–∏ **"–ó–∞–ø–∞–∑–∏"**

**–ê–∫–æ –µ admin –∏–ª–∏ ombudsman —Ä–æ–ª—è:**
- –©–µ –≤–∏–¥–∏—à –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: "–¢–æ–≤–∞ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑–∏—Å–∫–≤–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ"
- –©–µ –±—ä–¥–µ —Å—ä–∑–¥–∞–¥–µ–Ω–∞ –∑–∞—è–≤–∫–∞ —Å —Å—Ç–∞—Ç—É—Å "pending_approval"
- –í—Ç–æ—Ä–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ç—Ä—è–±–≤–∞ –¥–∞ —è –æ–¥–æ–±—Ä–∏

### –ö–∞–∫ –¥–∞ –æ–¥–æ–±—Ä—è –∑–∞—è–≤–∫–∞?

1. –û—Ç–∏–¥–∏ –≤ **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª** (–Ω–∞—á–∞–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
2. –í–∏–∂ –∫–∞—Ä—Ç–∞—Ç–∞ **"–ß–∞–∫–∞—â–∏ –æ–¥–æ–±—Ä–µ–Ω–∏—è"**
3. –ü—Ä–µ–≥–ª–µ–¥–∞–π –∑–∞—è–≤–∫–∞—Ç–∞ (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª, —Ä–æ–ª—è, –ø—Ä–∏—á–∏–Ω–∞)
4. –ö–ª–∏–∫–Ω–∏ **"‚úì –û–¥–æ–±—Ä–∏"** –∏–ª–∏ **"‚úó –û—Ç—Ö–≤—ä—Ä–ª–∏"**
5. –ù–∞–ø–∏—à–∏ –ø—Ä–∏—á–∏–Ω–∞ –∑–∞ —Ä–µ—à–µ–Ω–∏–µ—Ç–æ (optional –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ, required –ø—Ä–∏ –æ—Ç—Ö–≤—ä—Ä–ª—è–Ω–µ)
6. –ü–æ—Ç–≤—ä—Ä–¥–∏

**–†–µ–∑—É–ª—Ç–∞—Ç:**
- –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ ‚Üí —Ä–æ–ª—è—Ç–∞ —Å–µ –ø—Ä–∏—Å–≤–æ—è–≤–∞ + email –¥–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
- –ü—Ä–∏ –æ—Ç—Ö–≤—ä—Ä–ª—è–Ω–µ ‚Üí –∑–∞—è–≤–∫–∞—Ç–∞ —Å–µ –º–∞—Ä–∫–∏—Ä–∞ rejected + audit log

### –ö–∞–∫ –¥–∞ –≤–∏–¥—è –æ–¥–∏—Ç –ª–æ–≥–æ–≤–µ?

1. –û—Ç–∏–¥–∏ –≤ **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª** ‚Üí **–û–¥–∏—Ç –ª–æ–≥–æ–≤–µ**
2. –ò–∑–ø–æ–ª–∑–≤–∞–π —Ñ–∏–ª—Ç—Ä–∏—Ç–µ:
   - **–¢–∏–ø —Å—ä–±–∏—Ç–∏–µ:** –∏–∑–±–µ—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω (–Ω–∞–ø—Ä. "–ü—Ä–∏—Å–≤–æ–µ–Ω–∞ —Ä–æ–ª—è")
   - **–ê–∫—Ç—å–æ—Ä:** –≤—ä–≤–µ–¥–∏ email –Ω–∞ –∞–¥–º–∏–Ω
   - **–¢–∞—Ä–≥–µ—Ç:** –≤—ä–≤–µ–¥–∏ ID –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
   - **–ü–µ—Ä–∏–æ–¥:** –∏–∑–±–µ—Ä–∏ 24—á / 7–¥ / 30–¥ / –≤—Å–∏—á–∫–∏
3. –ö–ª–∏–∫–Ω–∏ **"‚ñ∂ –î–µ—Ç–∞–π–ª–∏"** –Ω–∞ —Ä–µ–¥ –∑–∞ –ø—ä–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
4. –ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–π —Å **"Export CSV"** –∏–ª–∏ **"Export JSON"**

---

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏—è—Ç –ø–∞–Ω–µ–ª –µ –Ω–∞–ø—ä–ª–Ω–æ –≥–æ—Ç–æ–≤ –∑–∞ production!**

### –ö–∞–∫–≤–æ –ø–æ—Å—Ç–∏–≥–Ω–∞—Ö–º–µ:
- ‚úÖ –ü—ä–ª–Ω–æ RBAC —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Ä–æ–ª–∏, –ø–æ–∫–∞–Ω–∏, –æ–¥–∏—Ç)
- ‚úÖ Dual-control approval flow
- ‚úÖ Email —Å–∏—Å—Ç–µ–º–∞ —Å –±—ä–ª–≥–∞—Ä—Å–∫–∏ templates
- ‚úÖ Real-time updates (SSE ready)
- ‚úÖ –ö—Ä–∞—Å–∏–≤–∏ UI —Å—Ç—Ä–∞–Ω–∏—Ü–∏ —Å TailwindCSS
- ‚úÖ –ü—ä–ª–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ security
- ‚úÖ Export —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ Comprehensive audit trail

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç:
- **Backend:** 100% ‚úÖ
- **Frontend:** 100% ‚úÖ
- **Security:** 100% ‚úÖ
- **Email:** 95% (needs config)
- **Real-time:** 90% (needs Firestore subs)
- **Production:** 95% ‚úÖ

### –°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏:
1. Configure email service (5 –º–∏–Ω)
2. Deploy to staging
3. User acceptance testing
4. Deploy to production
5. Monitor & iterate

**–ë—Ä–∞–≤–æ! –°–∏—Å—Ç–µ–º–∞—Ç–∞ –µ –≥–æ—Ç–æ–≤–∞!** üöÄüéä

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—ä–∑–¥–∞–¥–µ–Ω–∞: 22.10.2025, 22:10*  
*–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏—è: 3/3 –∑–∞–≤—ä—Ä—à–µ–Ω–∏*  
*–û–±—â–æ –≤—Ä–µ–º–µ: ~90 –º–∏–Ω—É—Ç–∏*
